(this["webpackJsonptraffic-editor-pwa"]=this["webpackJsonptraffic-editor-pwa"]||[]).push([[0],{112:function(e,t,n){},127:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(23),i=n.n(c),o=(n(112),n(9)),s=n.n(o),l=n(35),u=n(19),d=n(169),j=n(17),x=n(183),b=n(184),f=n(63),p=n(185),h=n(187),m=n(192),O=n(98),v=n.n(O),g=n(190),y=n(186),w=n(188),k=n(26),C=n(91),S=n(191),M=n(176),_=n(177),I=n(179),z=n(171),E=n(173),A=n(128),B=n(174),D=n(175),N=n(93),P=n.n(N),F=n(178),G=n(10),H=n(99),T=function(e){if(!e)return[];var t=[];for(var n in e){var r=e[n],a={name:n,type_idx:r[0],value:r[1]};t.push(a)}return t},L=function(e){return{x:e[0],y:-e[1],name:e[3],params:T(e[4])}},R=function(e){return{start_idx:e[0],end_idx:e[1],params:T(e[2])}},V=function(e){return{start_idx:e[0],end_idx:e[1],params:T(e[2])}},q=function(e,t){var n={name:e,elevation:0,vertices:[],walls:[],lanes:[]};n.elevation=t.elevation;var r,a=Object(G.a)(t.vertices);try{for(a.s();!(r=a.n()).done;){var c=r.value;n.vertices.push(L(c))}}catch(j){a.e(j)}finally{a.f()}var i,o=Object(G.a)(t.walls);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.walls.push(R(s))}}catch(j){o.e(j)}finally{o.f()}var l,u=Object(G.a)(t.lanes);try{for(u.s();!(l=u.n()).done;){var d=l.value;n.lanes.push(V(d))}}catch(j){u.e(j)}finally{u.f()}return n},J={name:"",filename:"",yaml:"",levels:[],lifts:[],crowd_sim:void 0},U=function(e,t){var n={};n.filename=e,n.yaml=t;var r=H.a.parse(t);for(var a in n.name=r.name,n.crowd_sim=r.crowd_sim,n.levels=[],r.levels){var c=r.levels[a];n.levels.push(q(a,c))}return console.log("parsed it"),n},W=function(){var e=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("http://localhost:8000/map_file").then((function(e){return e.text()})).then((function(e){return U("foo",e)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=Object(l.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/traffic-editor-js"+"/demos/".concat(t,"/").concat(t,".building.yaml")).then((function(e){return e.text()})).then((function(e){return U(t,e)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=a.a.createContext({building:J,updateBuilding:function(e){}}),X=n(12),Y=Object(d.a)((function(e){return{directoryButton:{fontSize:e.typography.h5.fontSize},filename:{fontSize:e.typography.h5.fontSize,textDecoration:"underline"},dialog:{backgroundColor:e.palette.background.paper}}}));function Z(e){var t=Y(e),n=a.a.useContext(Q).updateBuilding,r=a.a.useState([]),c=Object(u.a)(r,2),i=c[0],o=c[1],d=a.a.useState(),j=Object(u.a)(d,2),x=j[0],b=j[1],f=function(){var e=Object(l.a)(s.a.mark((function e(){var t,n,r,a,c,i,l,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o([]),e.next=3,window.showDirectoryPicker();case 3:return t=e.sent,e.next=6,b(t);case 6:n=!0,r=!1,e.prev=8,c=function(){var e=u;e.name.endsWith(".building.yaml")&&o((function(t){return[].concat(Object(k.a)(t),[e.name])}))},i=Object(C.a)(t.values());case 11:return e.next=13,i.next();case 13:return l=e.sent,n=l.done,e.next=17,l.value;case 17:if(u=e.sent,n){e.next=23;break}c();case 20:n=!0,e.next=11;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(8),r=!0,a=e.t0;case 29:if(e.prev=29,e.prev=30,n||null==i.return){e.next=34;break}return e.next=34,i.return();case 34:if(e.prev=34,!r){e.next=37;break}throw a;case 37:return e.finish(34);case 38:return e.finish(29);case 39:case"end":return e.stop()}}),e,null,[[8,25,29,39],[30,,34,38]])})));return function(){return e.apply(this,arguments)}}(),p=function(){var t=Object(l.a)(s.a.mark((function t(r){var a,c,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!x){t.next=11;break}return t.next=3,x.getFileHandle(r);case 3:return a=t.sent,t.next=6,a.getFile();case 6:return c=t.sent,t.next=9,c.text();case 9:i=t.sent,n(U(r,i));case 11:e.onOpen();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(X.jsxs)(S.a,{open:e.open,onClose:e.onCancel,children:[Object(X.jsx)(M.a,{children:"Open Building Map"}),Object(X.jsxs)(_.a,{className:t.dialog,children:[Object(X.jsx)(F.a,{variant:"contained",color:"primary",onClick:f,children:"Select Directory..."}),function(){if(i.length>0)return Object(X.jsx)("div",{children:Object(X.jsx)(z.a,{subheader:Object(X.jsx)(E.a,{component:"div",children:"Available Files"}),children:i.map((function(e){return Object(X.jsxs)(A.a,{button:!0,children:[Object(X.jsx)(B.a,{children:Object(X.jsx)(P.a,{})}),Object(X.jsx)(D.a,{primary:e,onClick:function(t){p(e)}})]},e)}))})})}()]}),Object(X.jsx)(I.a,{children:Object(X.jsx)(F.a,{onClick:e.onCancel,color:"primary",children:"Cancel"})})]})}var $=n(180),ee=n(193),te=n(94),ne=n.n(te),re=n(95),ae=n.n(re);function ce(){var e=a.a.useContext(Q).building;if(!e.filename)return Object(X.jsx)("p",{children:"No building loaded."});var t=10,n=function(e){return t+=3,Object(X.jsxs)(ee.a,{nodeId:String(t-3),label:e.name,children:[Object(X.jsx)(ee.a,{nodeId:String(t-2),label:"vertices",children:e.vertices.map((function(e){return function(e){t+=1;var n="("+e.x+", "+e.y+")";if(e.name&&(n+=" name: "+e.name),e.params.length){var r,a=Object(G.a)(e.params);try{for(a.s();!(r=a.n()).done;){var c=r.value;n+=" ".concat(c.name,"=").concat(c.value)}}catch(i){a.e(i)}finally{a.f()}}return Object(X.jsx)(ee.a,{nodeId:String(t),label:n},t)}(e)}))},t-2),Object(X.jsx)(ee.a,{nodeId:String(t-1),label:"walls",children:e.walls.map((function(e){return function(e){t+=1;var n="(".concat(e.start_idx," => ").concat(e.end_idx,")");return Object(X.jsx)(ee.a,{nodeId:String(t),label:n},t)}(e)}))},t-1)]},t-3)};return Object(X.jsxs)($.a,{defaultCollapseIcon:Object(X.jsx)(ne.a,{}),defaultExpandIcon:Object(X.jsx)(ae.a,{}),defaultExpanded:["2"],children:[Object(X.jsx)(ee.a,{nodeId:"0",label:"name: "+e.name}),Object(X.jsx)(ee.a,{nodeId:"1",label:"filename: "+e.filename}),Object(X.jsx)(ee.a,{nodeId:"2",label:"levels",children:e.levels.map((function(e){return n(e)}))})]})}var ie=n(13),oe=n(30),se=n(181),le=n(182);function ue(e){var t=a.a.useContext(Q).building,n=function(e){var t=e.elevation/2,n=e.vertices.map((function(e){return function(e,t){var n=e.x/50,r=e.y/50;return Object(X.jsxs)("mesh",{position:[n,r,.25+t],scale:1,rotation:new ie.Euler(Math.PI/2,0,0),children:[Object(X.jsx)("cylinderGeometry",{args:[.3,.3,.2,8]}),Object(X.jsx)("meshStandardMaterial",{color:"green"})]})}(e,t)})),r=e.walls.map((function(n){return function(e,t,n){var r=t[e.start_idx],a=t[e.end_idx],c=(r.x+a.x)/2/50,i=(r.y+a.y)/2/50,o=a.x-r.x,s=a.y-r.y,l=Math.sqrt(o*o+s*s)/50,u=Math.atan2(s,o);return Object(X.jsxs)("mesh",{position:[c,i,1+n],rotation:new ie.Euler(0,0,u),scale:1,children:[Object(X.jsx)("boxGeometry",{args:[l,.1,2]}),Object(X.jsx)("meshStandardMaterial",{color:"#8080d0"})]})}(n,e.vertices,t)})),a=e.lanes.map((function(n){return function(e,t,n){var r=t[e.start_idx],a=t[e.end_idx],c=(r.x+a.x)/2/50,i=(r.y+a.y)/2/50,o=a.x-r.x,s=a.y-r.y,l=Math.sqrt(o*o+s*s)/50,u=Math.atan2(s,o);return Object(X.jsxs)("mesh",{position:[c,i,0+n],rotation:new ie.Euler(0,0,u),scale:1,children:[Object(X.jsx)("boxGeometry",{args:[l,1,.1]}),Object(X.jsx)("meshStandardMaterial",{color:"#d08080"})]})}(n,e.vertices,t)})),c=Object(X.jsx)("gridHelper",{args:[100,100],rotation:new ie.Euler(Math.PI/2,0,0),position:new ie.Vector3(50,-50,t)});return[].concat(Object(k.a)(n),Object(k.a)(r),Object(k.a)(a),[c])},r=function(){var t=Object(oe.c)((function(e){return e.camera}));return"3d"===e.mode?(t.up=new ie.Vector3(0,0,1),t.position.x=20,t.position.y=-20,t.position.z=5,ie.Object3D.DefaultUp=new ie.Vector3(0,0,1),t.updateProjectionMatrix(),Object(X.jsx)(se.a,{enableDamping:!1,camera:t,target:[20,-10,0]})):(t.zoom=10,t.position.z=5,t.updateProjectionMatrix(),Object(X.jsx)(le.a,{enableDamping:!1,target:[10,-10,0],camera:t,maxPolarAngle:0,minAzimuthAngle:0,maxAzimuthAngle:0}))},c=function(t){return"3d"===e.mode?Object(X.jsx)(oe.a,{frameloop:"demand",children:t?t.children:Object(X.jsx)(X.Fragment,{})}):Object(X.jsx)(oe.a,{frameloop:"demand",orthographic:!0,children:t?t.children:Object(X.jsx)(X.Fragment,{})})};return Object(X.jsxs)(c,{children:[Object(X.jsx)(r,{}),Object(X.jsx)("axesHelper",{}),Object(X.jsx)("ambientLight",{}),Object(X.jsx)("pointLight",{position:[10,10,10]}),t.levels.map((function(e){return n(e)}))]})}var de=Object(d.a)((function(e){return{root:{flexGrow:1,minHeight:"100vh"},flex:{flex:1},menuButton:{marginLeft:-12,marginRight:20},toolbarMargin:e.mixins.toolbar,workingArea:{backgroundColor:"black",height:"calc(100vh - 64px)"}}})),je=Object(j.a)((function(e){return{root:{backgroundColor:e.palette.primary.dark,padding:e.spacing(.5)},grouped:{color:e.palette.primary.contrastText,"&.Mui-selected:hover, &:hover":{background:e.palette.primary.light},"&.Mui-selected":{background:e.palette.primary.light,color:e.palette.primary.contrastText},"&:not(:first-child)":{borderRadius:"5px"},"&:first-child":{borderRadius:"5px"}}}}))(m.a);function xe(e){var t=a.a.useState(null),n=Object(u.a)(t,2),r=n[0],c=n[1],i=a.a.useState(!1),o=Object(u.a)(i,2),d=o[0],j=o[1],m=a.a.useState(J),O=Object(u.a)(m,2),k=O[0],C=O[1],S=a.a.useState("3d"),M=Object(u.a)(S,2),_=M[0],I=M[1],z=de(e);return Object(X.jsx)("div",{className:z.root,children:Object(X.jsxs)(Q.Provider,{value:{building:k,updateBuilding:C},children:[Object(X.jsx)(x.a,{position:"fixed",children:Object(X.jsxs)(b.a,{children:[Object(X.jsx)(p.a,{className:z.menuButton,color:"inherit","aria-label":"Menu",onClick:function(e){c(e.currentTarget)},children:Object(X.jsx)(v.a,{})}),Object(X.jsxs)(g.a,{keepMounted:!0,anchorEl:r,open:Boolean(r),onClose:function(){return c(null)},getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[Object(X.jsx)(y.a,{onClick:Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=C,e.next=3,W();case 3:e.t1=e.sent,(0,e.t0)(e.t1),c(null);case 6:case"end":return e.stop()}}),e)}))),children:"Open map from localhost:8000"}),Object(X.jsx)(y.a,{onClick:Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=C,e.next=3,K("office");case 3:e.t1=e.sent,(0,e.t0)(e.t1),c(null);case 6:case"end":return e.stop()}}),e)}))),children:"Open demo map"}),Object(X.jsx)(y.a,{onClick:function(){j(!0),c(null)},children:"Open map from local file..."})]}),Object(X.jsx)(f.a,{variant:"h6",color:"inherit",className:z.flex,children:"Traffic Editor"}),Object(X.jsxs)(je,{value:_,size:"small",exclusive:!0,onChange:function(e,t){null!==t&&I(t)},"aria-label":"editor mode",children:[Object(X.jsx)(h.a,{value:"3d",children:"3D"}),Object(X.jsx)(h.a,{value:"2d",children:"2D"})]})]})}),Object(X.jsx)("div",{className:z.toolbarMargin}),Object(X.jsx)(Z,{open:d,onOpen:function(){return j(!1)},onCancel:function(){return j(!1)}}),Object(X.jsxs)(w.a,{container:!0,spacing:0,children:[Object(X.jsx)(w.a,{item:!0,xs:3,children:Object(X.jsx)(ce,{})}),Object(X.jsx)(w.a,{item:!0,xs:9,className:z.workingArea,children:Object(X.jsx)(ue,{mode:_})})]})]})})}i.a.render(Object(X.jsx)(a.a.StrictMode,{children:Object(X.jsx)(xe,{})}),document.getElementById("root"))}},[[127,1,2]]]);
//# sourceMappingURL=main.66ff721f.chunk.js.map