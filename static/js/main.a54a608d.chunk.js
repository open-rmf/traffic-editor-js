(this["webpackJsonptraffic-editor-pwa"]=this["webpackJsonptraffic-editor-pwa"]||[]).push([[0],{186:function(e,t,n){},200:function(e,t){},202:function(e,t){},238:function(e,t){},239:function(e,t){},245:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),i=n(29),c=n.n(i),l=(n(186),n(307)),s=n(325),u=n(14),d=n.n(u),f=n(32),m=n(30),v=n(15),j=n(12),p=n(2),b=n(4),h=n(5),x=n(6),O=n(101),y=n.n(O),g=n(151),w=n(7),_=n(328),M=n(25),k=function(){function e(){Object(p.a)(this,e),this.type_idx=0,this.name="",this.value=0,this.uuid="",this.optional=!1}return Object(b.a)(e,null,[{key:"fromYAML",value:function(t,n){var a=new e;return a.name=t,a.type_idx=n[0],a.value=n[1],a.uuid=Object(_.a)(),a.optional=!1,a}}]),e}(),L=function(){function e(){Object(p.a)(this,e),this.uuid="",this.params=[],this.props=[],this.object_type_name=""}return Object(b.a)(e,[{key:"paramsFromYAML",value:function(e){var t=this,n=function(n){var a=k.fromYAML(n,e[n]),r=!1;t.params=t.params.map((function(e){return e.name===n?(r=!0,a):e})),r||t.params.push(a)};for(var a in e)n(a)}},{key:"paramsToYAML",value:function(){var e,t=new M.a.YAMLMap,n=Object(j.a)(this.params);try{for(n.s();!(e=n.n()).done;){var a=e.value;if(!a.optional||""!==a.value){var r=new M.a.YAMLSeq;r.add(a.type_idx),r.add(a.value),r.flow=!0,t.add({key:a.name,value:r})}}}catch(o){n.e(o)}finally{n.f()}return t.flow=!0,t}},{key:"getParam",value:function(e,t){var n,a=Object(j.a)(this.params);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(r.name===e)return r.value}}catch(o){a.e(o)}finally{a.f()}return t}},{key:"addParam",value:function(e,t,n,a){var r=new k;r.uuid=Object(_.a)(),r.name=e,r.value=t,r.type_idx=n,r.optional=a,this.params=[].concat(Object(m.a)(this.params),[r])}}],[{key:"roundNicely",value:function(e){return Math.round(1e3*e)/1e3}}]),e}(),C=function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;Object(p.a)(this,e),this.name="",this.get_value=function(){return""},this.set_value=function(e){},this.canModify=!1,this.uuid="",this.name=t,this.get_value=n,this.uuid=Object(_.a)(),void 0!==a&&(this.set_value=a,this.canModify=!0)},S=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).start_idx=-1,e.end_idx=-1,e.graph_idx=0,e}return Object(b.a)(n,[{key:"toYAML",value:function(){var e=new M.a.YAMLSeq;return e.add(this.start_idx),e.add(this.end_idx),e.add(this.paramsToYAML()),e.flow=!0,e}},{key:"addDefaultParams",value:function(){this.addParam("bidirectional",!1,4,!1),this.addParam("graph_idx",0,2,!1)}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromYAML",value:function(e){var t=new n;return t.object_type_name="Lane",t.uuid=Object(_.a)(),t.start_idx=e[0],t.end_idx=e[1],e.length>2&&t.paramsFromYAML(e[2]),t}}]),n}(L),A=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;return Object(p.a)(this,n),(e=t.call(this)).x=0,e.y=0,e.name="",e.props.push(new C("name",(function(){return e.name}),(function(t){e.name=t}))),e.props.push(new C("x",(function(){return L.roundNicely(e.x)}))),e.props.push(new C("y",(function(){return L.roundNicely(e.y)}))),e.props.push(new C("lat",(function(){var t=6378137,n=t*Math.PI*(128+e.y/1e3)/128;return 180/Math.PI*(2*Math.atan(Math.exp(n/t))-Math.PI/2)}))),e.props.push(new C("lon",(function(){return(e.x/1e3-128)/128*180}))),e.addParam("spawn_robot_type","",1,!0),e.addParam("spawn_robot_name","",1,!0),e}return Object(b.a)(n,[{key:"toYAML",value:function(e){var t=new M.a.YAMLSeq;return t.add(this.x/e[0]),t.add(this.y/e[1]),t.add(0),t.add(this.name),this.params.length&&t.add(this.paramsToYAML()),t.flow=!0,t}},{key:"addDefaultParams",value:function(){this.addParam("is_charger",!1,4,!1),this.addParam("is_parking_spot",!1,4,!1),this.addParam("is_holding_point",!1,4,!1)}},{key:"getCenterXY",value:function(){return[this.x,this.y]}}],[{key:"fromYAML",value:function(e,t){var a=new n;return a.object_type_name="Vertex",a.uuid=Object(_.a)(),a.x=e[0]*t[0],a.y=e[1]*t[1],a.name=e[3],e.length>4&&a.paramsFromYAML(e[4]),a}}]),n}(L),P=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="",e.x=0,e.y=0,e}return Object(b.a)(n,[{key:"toYAML",value:function(e){var t=new M.a.YAMLMap;return t.add({key:"id",value:this.uuid}),t.add({key:"name",value:this.name}),t.add({key:"x",value:this.x/e[0]}),t.add({key:"y",value:this.y/e[1]}),t.flow=!0,t}},{key:"getCenterXY",value:function(){return[this.x,this.y]}}],[{key:"fromYAML",value:function(e,t){var a=new n;return a.object_type_name="Feature",a.uuid=e.id,a.name=e.name,a.x=e.x*t[0],a.y=e.y*t[1],a.props.push(new C("name",(function(){return a.name}))),a.props.push(new C("x",(function(){return L.roundNicely(a.x)}))),a.props.push(new C("y",(function(){return L.roundNicely(a.y)}))),a}}]),n}(L);function Y(e){return e===a.Legacy?"legacy":e===a.CartesianMeters?"cartesian_meters":e===a.WebMercator?"web_mercator":"unknown"}function E(e){return e===a.Legacy?[1,-1]:e===a.CartesianMeters?[1,1]:e===a.WebMercator?[1e3,1e3]:[1,1]}!function(e){e[e.Undefined=0]="Undefined",e[e.Legacy=1]="Legacy",e[e.CartesianMeters=2]="CartesianMeters",e[e.WebMercator=3]="WebMercator"}(a||(a={}));var D,T=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;return Object(p.a)(this,n),(e=t.call(this)).name="",e.elevation=0,e.scale=1.234,e.doors=[],e.vertices=[],e.walls=[],e.measurements=[],e.floors=[],e.lanes=[],e.models=[],e.images=[],e.features=[],e.constraints=[],e.coordinateSystem=a.Legacy,e.props.push(new C("name",(function(){return e.name}))),e.props.push(new C("elevation",(function(){return e.elevation}))),e.props.push(new C("scale",(function(){return e.scale}))),e.props.push(new C("coordinates",(function(){return Y(e.coordinateSystem)}))),e}return Object(b.a)(n,[{key:"toYAML",value:function(){var e=new M.a.YAMLMap;e.add({key:"constraints",value:this.constraints.map((function(e){return e.toYAML()}))}),e.add({key:"doors",value:this.doors.map((function(e){return e.toYAML()}))}),this.images.length>0&&this.images[0].isLegacyDefaultImage&&e.add({key:"drawing",value:{filename:this.images[0].filename}});var t=E(this.coordinateSystem);console.log("Level.toYAML() coord_scale = ".concat(t)),e.add({key:"elevation",value:this.elevation}),e.add({key:"features",value:this.features.map((function(e){return e.toYAML(t)}))}),e.add({key:"flattened_x_offset",value:0}),e.add({key:"flattened_y_offset",value:0}),e.add({key:"floors",value:this.floors.map((function(e){return e.toYAML()}))}),e.add({key:"lanes",value:this.lanes.map((function(e){return e.toYAML()}))});var n,a=new M.a.YAMLMap,r=Object(j.a)(this.images);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.isLegacyDefaultImage||a.add({key:o.name,value:o.toLayerYAML()})}}catch(i){r.e(i)}finally{r.f()}return e.add({key:"layers",value:a}),e.add({key:"measurements",value:this.measurements.map((function(e){return e.toYAML()}))}),e.add({key:"models",value:this.models.map((function(e){return e.toYAML()}))}),e.add({key:"vertices",value:this.vertices.map((function(e){return e.toYAML(t)}))}),e.add({key:"walls",value:this.walls.map((function(e){return e.toYAML()}))}),e}},{key:"calculateScale",value:function(){if(this.coordinateSystem===a.Legacy){var e,t=0,n=0,r=Object(j.a)(this.measurements);try{for(r.s();!(e=r.n()).done;){var o=e.value;n++;var i=this.vertices[o.start_idx].x-this.vertices[o.end_idx].x,c=this.vertices[o.start_idx].y-this.vertices[o.end_idx].y,l=Math.sqrt(i*i+c*c);t+=o.distance/l}}catch(s){r.e(s)}finally{r.f()}this.scale=n>0?t/n:.05}else this.scale=1}},{key:"transformPoint",value:function(e,t){return[e*this.scale,t*this.scale]}},{key:"inverseTransformPoint",value:function(e,t){return[e/this.scale,t/this.scale]}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromYAML",value:function(e,t,a){var r=new n;r.object_type_name="Level",r.uuid=Object(_.a)(),r.name=e,r.coordinateSystem=a;var o=E(r.coordinateSystem);if(t.drawing&&t.drawing.filename){var i=new J;i.uuid=Object(_.a)(),i.filename=t.drawing.filename,i.isLegacyDefaultImage=!0,r.images.push(i)}for(var c in t.elevation&&(r.elevation=t.elevation),t.constraints&&(r.constraints=t.constraints.map((function(e){return K.fromYAML(e)}))),t.doors&&(r.doors=t.doors.map((function(e){return q.fromYAML(e)}))),t.features&&(r.features=t.features.map((function(e){return P.fromYAML(e,o)}))),t.floors&&(r.floors=t.floors.map((function(e){return X.fromYAML(e)}))),t.layers)r.images.push(J.fromLayerYAML(c,t.layers[c]));return t.lanes&&(r.lanes=t.lanes.map((function(e){return S.fromYAML(e)}))),t.models&&(r.models=t.models.map((function(e){return Q.fromYAML(e)}))),t.measurements&&(r.measurements=t.measurements.map((function(e){return H.fromYAML(e)}))),t.vertices&&(r.vertices=t.vertices.map((function(e){return A.fromYAML(e,o)}))),t.walls&&(r.walls=t.walls.map((function(e){return G.fromYAML(e)}))),r.calculateScale(),r}}]),n}(L),I=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;return Object(p.a)(this,n),(e=t.call(this)).name="",e.id=0,e.default_lane_width=.5,e.props.push(new C("name",(function(){return e.name}))),e.props.push(new C("default lane width",(function(){return e.default_lane_width}))),e}return Object(b.a)(n,[{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromYAML",value:function(e,t){var a=new n;return a.uuid=Object(_.a)(),a.id=e,a.name=t.name,a.default_lane_width=t.default_lane_width,a}}]),n}(L),N=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;return Object(p.a)(this,n),(e=t.call(this)).name="",e.filename="",e.url_base="",e.levels=[],e.graphs=[],e.reference_level_name="",e.uuid="",e.params=[],e.props=[],e.object_type_name="Site",e.coordinateSystem=a.Legacy,e.yaml_doc=new M.a.Document,e.save=function(){},e.addParam("generate_crs","",1,!0),e.addParam("generate_origin_vertex","",1,!0),e}return Object(b.a)(n,[{key:"toYAMLString",value:function(){var e,t=new M.a.Document(new M.a.YAMLMap),n=new M.a.YAMLMap,a=Object(j.a)(this.levels);try{for(a.s();!(e=a.n()).done;){var r=e.value;n.add({key:r.name,value:r.toYAML()})}}catch(i){a.e(i)}finally{a.f()}t.add({key:"coordinate_system",value:Y(this.coordinateSystem)}),t.add({key:"crowd_sim",value:this.yaml_doc.get("crowd_sim")}),t.add({key:"levels",value:n});var o=new M.a.YAMLMap;return o.flow=!0,t.add({key:"lifts",value:o}),t.add({key:"name",value:this.name}),t.add({key:"parameters",value:this.paramsToYAML()}),t.toString({lineWidth:0,minContentWidth:2})}},{key:"computeBoundingBox",value:function(){var e,t=new w.Vector3(1/0,1/0,1/0),n=new w.Vector3(-1/0,-1/0,-1/0),a=Object(j.a)(this.levels);try{for(a.s();!(e=a.n()).done;){var r,o=e.value,i=Object(j.a)(o.vertices);try{for(i.s();!(r=i.n()).done;){var c=r.value;c.x<t.x&&(t.x=c.x),c.x>n.x&&(n.x=c.x),c.y<t.y&&(t.y=c.y),c.y>n.y&&(n.y=c.y)}}catch(l){i.e(l)}finally{i.f()}}}catch(l){a.e(l)}finally{a.f()}return new w.Box3(t,n)}},{key:"computeInitialCameraPose",value:function(){if(this.levels.length){var e=this.computeBoundingBox(),t=(e.min.x+e.max.x)/2,n=(e.min.y+e.max.y)/2,r=this.levels[0].transformPoint(t,n),o=Object(v.a)(r,2),i=o[0],c=o[1],l=new w.Vector3(i,c,0);return{position:new w.Vector3(l.x+10,l.y-10,l.z+10),target:l,zoom:20}}return this.coordinateSystem===a.Legacy?{position:new w.Vector3(10,10,10),target:new w.Vector3(0,0,0),zoom:20}:{position:new w.Vector3(201830,-127030,10),target:new w.Vector3(201830,-127030,0),zoom:5}}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromNewCommand",value:function(){var e=new n;return e.uuid=Object(_.a)(),e.name="Unnamed Site",e.coordinateSystem=a.WebMercator,e}},{key:"fromYAML",value:function(e){var t=M.a.parse(e),r=new n;for(var o in r.uuid=Object(_.a)(),r.name=t.name,t.parameters&&r.paramsFromYAML(t.parameters),t.coordinate_system&&(r.coordinateSystem=function(e){var t=a.Undefined;return"legacy"===e?t=a.Legacy:"cartesian_meters"===e?t=a.CartesianMeters:"web_mercator"===e?t=a.WebMercator:console.log("AHHHHH unknown coordinate system: "+e),t}(t.coordinate_system)),t.graphs)r.graphs.push(I.fromYAML(+o,t.graphs[o]));for(var i in t.levels){var c=t.levels[i];r.levels.push(T.fromYAML(i,c,r.coordinateSystem))}return t.reference_level_name?r.reference_level_name=t.reference_level_name:r.levels.length>0&&(r.reference_level_name=r.levels[0].name),r.yaml_doc=M.a.parseDocument(e),r}}]),n}(L);function z(e,t){var n=N.fromYAML(e);n.url_base=t;var a=n.computeInitialCameraPose();return Z.setState({site:n,selection:null,cameraInitialPose:a}),n}function V(e,t){return R.apply(this,arguments)}function R(){return(R=Object(f.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t+n).then((function(e){return e.text()})).then((function(e){return z(e,t)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return W.apply(this,arguments)}function W(){return(W=Object(f.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V("/traffic-editor-js"+"/demos/".concat(t,"/"),"".concat(t,".building.yaml"));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){return U.apply(this,arguments)}function U(){return(U=Object(f.a)(d.a.mark((function e(t){var n,a,r,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object.getPrototypeOf(M.a.YAMLMap).maxFlowStringSingleLineLength=1e4,n=Z.getState(),a=n.site,r=a.toYAMLString(),o=new Blob([r]).size,e.next=6,fetch(t,{method:"POST",headers:{"content-type":"application/x-yaml","content-length":o.toString()},body:r});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e[e.SELECT=0]="SELECT",e[e.MOVE=1]="MOVE",e[e.ADD_VERTEX=2]="ADD_VERTEX",e[e.ADD_LANE=3]="ADD_LANE",e[e.ADD_WALL=4]="ADD_WALL",e[e.NONE=5]="NONE"}(D||(D={}));var G=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).start_idx=-1,e.end_idx=-1,e}return Object(b.a)(n,[{key:"toYAML",value:function(){var e=new M.a.YAMLSeq;return e.add(this.start_idx),e.add(this.end_idx),e.add(this.paramsToYAML()),e.flow=!0,e}},{key:"addDefaultParams",value:function(){this.addParam("texture_name","default",1,!1)}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromYAML",value:function(e){var t=new n;return t.object_type_name="Wall",t.uuid=Object(_.a)(),t.paramsFromYAML(e[2]),t.start_idx=e[0],t.end_idx=e[1],t}}]),n}(L),H=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).start_idx=-1,e.end_idx=-1,e.distance=1,e}return Object(b.a)(n,[{key:"toYAML",value:function(){var e=new M.a.YAMLSeq;e.add(this.start_idx),e.add(this.end_idx);var t=this.paramsToYAML();return t.add({key:"distance",value:[3,this.distance]}),e.add(t),e.flow=!0,e}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromYAML",value:function(e){var t=new n;return t.object_type_name="Measurement",t.uuid=Object(_.a)(),t.start_idx=e[0],t.end_idx=e[1],t.distance=e[2].distance[1],t}}]),n}(L),q=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).start_idx=-1,e.end_idx=-1,e}return Object(b.a)(n,[{key:"toYAML",value:function(){var e=new M.a.YAMLSeq;return e.add(this.start_idx),e.add(this.end_idx),e.add(this.paramsToYAML()),e.flow=!0,e}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromYAML",value:function(e){var t=new n;return t.object_type_name="Door",t.uuid=Object(_.a)(),t.paramsFromYAML(e[2]),t.start_idx=e[0],t.end_idx=e[1],t}}]),n}(L),X=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).vertex_indices=[],e}return Object(b.a)(n,[{key:"toYAML",value:function(){var e=new M.a.YAMLMap;e.add({key:"parameters",value:this.paramsToYAML()});var t,n=new M.a.YAMLSeq,a=Object(j.a)(this.vertex_indices);try{for(a.s();!(t=a.n()).done;){var r=t.value;n.add(r)}}catch(o){a.e(o)}finally{a.f()}return n.flow=!0,e.add({key:"vertices",value:n}),e}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromYAML",value:function(e){var t=new n;return t.uuid=Object(_.a)(),t.paramsFromYAML(e.parameters),t.vertex_indices=e.vertices.map((function(e){return e})),t}}]),n}(L),J=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="",e.filename="",e.offset=new w.Vector3(0,0,0),e.yaw=0,e.scale=1,e.isLegacyDefaultImage=!1,e.color=[1,1,1,1],e.visible=!0,e.features=[],e.blob=new Blob([]),e}return Object(b.a)(n,[{key:"toLayerYAML",value:function(){var e=new M.a.YAMLMap,t=new M.a.YAMLSeq;t.add(this.color[0]),t.add(this.color[1]),t.add(this.color[2]),t.add(this.color[3]),t.flow=!0,e.add({key:"color",value:t}),e.add({key:"features",value:this.features.map((function(e){return e.toYAML([1,1])}))}),e.add({key:"filename",value:this.filename});var n=new M.a.YAMLMap;return n.add({key:"scale",value:this.scale}),n.add({key:"translation_x",value:this.offset.x}),n.add({key:"translation_y",value:this.offset.y}),n.add({key:"yaw",value:this.yaw}),e.add({key:"transform",value:n}),e.add({key:"visible",value:this.visible}),e}},{key:"loadBlob",value:function(e){this.blob=e,console.log("image ".concat(this.filename," retrieved ").concat(this.blob.size," bytes"))}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromLayerYAML",value:function(e,t){var a=new n;return a.object_type_name="Image",a.uuid=Object(_.a)(),a.name=e,a.filename=t.filename,a.color=t.color,a.offset.x=t.transform.translation_x,a.offset.y=t.transform.translation_y,a.scale=t.transform.scale,a.yaw=t.transform.yaw,a.isLegacyDefaultImage=!1,a.visible=t.visible,a.features=t.features.map((function(e){return P.fromYAML(e,[1,1])})),a}}]),n}(L),K=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).ids=[],e}return Object(b.a)(n,[{key:"toYAML",value:function(){var e=new M.a.YAMLMap;return e.add({key:"ids",value:this.ids}),e.flow=!0,e}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromYAML",value:function(e){var t=new n;return t.uuid=Object(_.a)(),t.ids=[e.ids[0],e.ids[1]],t}}]),n}(L),Q=function(e){Object(h.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).model_name="",e.instance_name="",e.is_static=!0,e.x=0,e.y=0,e.z=0,e.yaw=0,e}return Object(b.a)(n,[{key:"toYAML",value:function(){var e=new M.a.YAMLMap;return e.add({key:"model_name",value:this.model_name}),e.add({key:"name",value:this.instance_name}),e.add({key:"static",value:this.is_static}),e.add({key:"x",value:this.x}),e.add({key:"y",value:-this.y}),e.add({key:"yaw",value:this.yaw}),e.add({key:"z",value:this.z}),e.flow=!0,e}},{key:"getCenterXY",value:function(){return[0,0]}}],[{key:"fromYAML",value:function(e){var t=new n;return t.object_type_name="Model",t.uuid=Object(_.a)(),t.model_name=e.model_name,t.instance_name=e.name,t.is_static=e.static,t.x=e.x,t.y=-e.y,t.yaw=e.yaw,t.z=e.z,t}}]),n}(L),Z=y()((function(e){return{site:new N,selection:null,editorMode:"2d",enableMotionControls:!0,activeTool:D.SELECT,activeMotionTool:D.NONE,propertyRepaintCount:0,repaintCount:0,disableEditorTools:!1,activeUUID:"",cameraInitialPose:{position:new w.Vector3(0,0,100),target:new w.Vector3(0,0,0),zoom:20},cameraPose:{position:new w.Vector3(0,0,100),target:new w.Vector3(0,0,0),zoom:20},set:function(t){return e(Object(g.a)(t))},mqtt_client:null,mqtt_robot_telemetry:[],mapType:""}}));function $(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Z.setState({selection:e}),t){var n=e.getCenterXY(),a=Object(v.a)(n,2),r=a[0],o=a[1],i={position:new w.Vector3(r,o,100),target:new w.Vector3(r,o,0),zoom:20};Z.setState({cameraInitialPose:i})}}function ee(e){e((function(e){e.selection=null}))}function te(e){Z.setState({activeTool:e,activeUUID:""})}function ne(e){Z.setState({activeMotionTool:e})}function ae(e){e((function(e){e.propertyRepaintCount+=1}))}function re(e,t,n,a,r){e((function(e){e.site.levels.map((function(e){return e.uuid===t&&e.models.map((function(e){return e.uuid===n&&(e.x=a,e.y=r),e})),e})),e.repaintCount=e.repaintCount+1}))}function oe(e,t,n,a,r){e((function(e){e.site.levels.map((function(e){return e===t&&e.features.map((function(e){return e.uuid===n&&(e.x=a,e.y=r),e})),e})),e.repaintCount=e.repaintCount+1}))}function ie(){return ce.apply(this,arguments)}function ce(){return(ce=Object(f.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("local_file"!==(t=Z.getState().mapType)){e.next=5;break}Z.getState().site.save(),e.next=16;break;case 5:if("local_rest"!==t){e.next=15;break}return e.prev=6,e.next=9,B("http://localhost:8000/map_file");case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(6);case 13:e.next=16;break;case 15:case 16:case"end":return e.stop()}}),e,null,[[6,11]])})))).apply(this,arguments)}var le=n(300),se=n(335),ue=n(153),de=n.n(ue),fe=n(154),me=n.n(fe),ve=n(1);function je(e){return Object(ve.jsx)(se.a,{nodeId:e.feature.uuid,label:"".concat(e.feature.x,", ").concat(e.feature.y),onClick:function(t){$(e.feature)}},e.feature.uuid)}function pe(e){return Object(ve.jsx)(se.a,{nodeId:e.graph.uuid,label:"".concat(e.graph.id,": ").concat(e.graph.name),onClick:function(t){$(e.graph)}},e.graph.uuid)}function be(e){return Object(ve.jsx)(se.a,{nodeId:e.model.uuid,label:"".concat(e.model.instance_name),onClick:function(t){$(e.model)}},e.model.uuid)}function he(e){return Object(ve.jsx)(se.a,{nodeId:e.constraint.uuid,label:"".concat(e.constraint.ids[0].substring(1,9)," - ").concat(e.constraint.ids[1].substring(1,9)),onClick:function(t){$(e.constraint)},children:e.constraint.params.map((function(e){return Object(ve.jsx)(Oe,{param:e})}))},e.constraint.uuid)}function xe(e){var t="(".concat(e.door.start_idx," => ").concat(e.door.end_idx,")");return Object(ve.jsx)(se.a,{nodeId:e.door.uuid,onClick:function(t){$(e.door)},label:t},e.door.uuid)}function Oe(e){return Object(ve.jsx)(se.a,{nodeId:e.param.uuid,label:"".concat(e.param.name," = ").concat(e.param.value)},e.param.uuid)}function ye(e){return Object(ve.jsxs)(se.a,{nodeId:e.image.uuid,label:e.image.filename,onClick:function(t){$(e.image)},children:[e.image.params.map((function(e){return Object(ve.jsx)(Oe,{param:e})})),Object(ve.jsx)(se.a,{nodeId:"".concat(e.image.uuid,"_features"),label:"features",children:e.image.features.map((function(e){return Object(ve.jsx)(je,{feature:e})}))},"".concat(e.image.uuid,"_features"))]},e.image.uuid)}function ge(e){var t="floor ("+e.floor.vertex_indices.map((function(e){return e.toString()})).join(", ")+")";return Object(ve.jsx)(se.a,{nodeId:e.floor.uuid,label:t,onClick:function(t){$(e.floor)},children:e.floor.params.map((function(e){return Object(ve.jsx)(Oe,{param:e})}))},e.floor.uuid)}function we(e){var t="(".concat(e.wall.start_idx," => ").concat(e.wall.end_idx,")");return Object(ve.jsx)(se.a,{nodeId:e.wall.uuid,onClick:function(t){$(e.wall)},label:t},e.wall.uuid)}function _e(e){var t="(".concat(e.measurement.start_idx,"-").concat(e.measurement.end_idx,") = ").concat(e.measurement.distance);return Object(ve.jsx)(se.a,{nodeId:e.measurement.uuid,onClick:function(t){$(e.measurement)},label:t},e.measurement.uuid)}function Me(e){var t="(".concat(e.lane.start_idx," => ").concat(e.lane.end_idx,")");return Object(ve.jsx)(se.a,{nodeId:e.lane.uuid,label:t,onClick:function(t){$(e.lane,!0)}},e.lane.uuid)}function ke(e){var t="("+e.vertex.x+", "+e.vertex.y+")";return e.vertex.name&&(t=e.vertex.name),Object(ve.jsx)(se.a,{nodeId:e.vertex.uuid,onClick:function(t){$(e.vertex,!0)},label:t},e.vertex.uuid)}function Le(e){return Object(ve.jsxs)(se.a,{nodeId:e.level.uuid,label:e.level.name,onClick:function(t){$(e.level)},children:[Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_constraints",label:"constraints",children:e.level.constraints.map((function(e){return Object(ve.jsx)(he,{constraint:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_doors",label:"doors",children:e.level.doors.map((function(e){return Object(ve.jsx)(xe,{door:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_features",label:"features",children:e.level.features.map((function(e){return Object(ve.jsx)(je,{feature:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_floors",label:"floors",children:e.level.floors.map((function(e){return Object(ve.jsx)(ge,{floor:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_images",label:"images",children:e.level.images.map((function(e){return Object(ve.jsx)(ye,{image:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_lanes",label:"lanes",children:e.level.lanes.map((function(e){return Object(ve.jsx)(Me,{lane:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_measurements",label:"measurements",children:e.level.measurements.map((function(e){return Object(ve.jsx)(_e,{measurement:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_models",label:"models",children:e.level.models.map((function(e){return Object(ve.jsx)(be,{model:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_vertices",label:"vertices",children:e.level.vertices.map((function(e){return Object(ve.jsx)(ke,{vertex:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.level.uuid+"_walls",label:"walls",children:e.level.walls.map((function(e){return Object(ve.jsx)(we,{wall:e})}))})]},e.level.uuid)}function Ce(){var e=Z((function(e){return e.site}));return""===e.name?Object(ve.jsxs)("div",{style:{margin:"1em"},children:[Object(ve.jsx)("p",{children:"No map loaded."}),Object(ve.jsx)("p",{children:"To load a map, click the menu icon in the upper-left."})]}):Object(ve.jsxs)(le.a,{defaultCollapseIcon:Object(ve.jsx)(de.a,{}),defaultExpandIcon:Object(ve.jsx)(me.a,{}),children:[Object(ve.jsx)(se.a,{nodeId:e.uuid+"_name",label:"site name: "+e.name,onClick:function(t){$(e)}},e.uuid+"_name"),Object(ve.jsx)(se.a,{nodeId:e.uuid+"_filename",label:"filename: "+e.filename}),Object(ve.jsx)(se.a,{nodeId:e.uuid+"_ref",label:"reference level: "+e.reference_level_name}),Object(ve.jsx)(se.a,{nodeId:e.uuid+"_graphs",label:"graphs",children:e.graphs.map((function(e){return Object(ve.jsx)(pe,{graph:e})}))}),Object(ve.jsx)(se.a,{nodeId:e.uuid+"_levels",label:"levels",children:e.levels.map((function(e){return Object(ve.jsx)(Le,{level:e})}))})]})}var Se=n(27),Ae=n(332),Pe=n(301),Ye=n(302);function Ee(e){var t=Z((function(e){return e.selection})),n=e.vertex_start,a=e.vertex_end,r=e.level.transformPoint((n.x+a.x)/2,(n.y+a.y)/2),i=Object(v.a)(r,2),c=i[0],l=i[1],s=a.x-n.x,u=a.y-n.y,d=Math.sqrt(s*s+u*u)*e.level.scale,f=Math.atan2(u,s),m=o.a.useMemo((function(){var n=new w.Color(.1,.4,.4);return t&&t.uuid===e.door.uuid&&n.setRGB(1,.4,.1),n}),[t,e.door.uuid]);return Object(ve.jsxs)("mesh",{position:[c,l,1+e.elevation],rotation:new w.Euler(0,0,f),scale:1,onClick:function(t){t.stopPropagation(),$(e.door)},children:[Object(ve.jsx)("boxGeometry",{args:[d,.5,2]}),Object(ve.jsx)("meshStandardMaterial",{color:m})]},e.door.uuid)}var De=n(331);function Te(e){var t=Z((function(e){return e.selection})),n=Z((function(e){return e.set})),a=Z((function(e){return e.editorMode})),r=Z((function(e){return e.activeTool===D.MOVE})),i=o.a.useState(!1),c=Object(v.a)(i,2),l=c[0],s=c[1],u=e.level.transformPoint(e.feature.x,e.feature.y),d=Object(v.a)(u,2),f=d[0],m=d[1],j="rgb(200, 200, 0)";return t&&t.uuid===e.feature.uuid&&(j="rgb(255, 100, 10)"),Object(ve.jsxs)("group",{children:[Object(ve.jsxs)("mesh",{position:[f,m,.25+e.elevation],scale:1,rotation:new w.Euler(Math.PI/2,0,0),onClick:function(e){e.stopPropagation()},onPointerDown:function(t){$(e.feature),r&&(t.stopPropagation(),s(!0),t.target&&t.target.setPointerCapture(t.pointerId))},onPointerUp:function(e){e.stopPropagation(),s(!1),e.target&&e.target.releasePointerCapture(e.pointerId),ae(n)},onPointerMove:function(t){if(l)if(t.stopPropagation(),"2d"===a){var r=e.level.inverseTransformPoint(t.unprojectedPoint.x,t.unprojectedPoint.y),o=Object(v.a)(r,2),i=o[0],c=o[1];oe(n,e.level,e.feature.uuid,i,c)}else{var s=new w.Vector3;t.ray.intersectPlane(new w.Plane(new w.Vector3(0,0,1),e.elevation),s);var u=e.level.inverseTransformPoint(s.x,s.y),d=Object(v.a)(u,2),f=d[0],m=d[1];oe(n,e.level,e.feature.uuid,f,m)}},children:[Object(ve.jsx)("cylinderGeometry",{args:[.05,.15,.4,16]}),Object(ve.jsx)("meshStandardMaterial",{color:j})]},e.feature.uuid),Object(ve.jsx)(De.a,{color:"blue",position:[f,m,.36+e.elevation],children:e.feature.name})]})}function Ie(e){var t=Z((function(e){return e.selection})),n=o.a.useMemo((function(){var t,n=new w.Shape,a=!1,r=Object(j.a)(e.vertices);try{for(r.s();!(t=r.n()).done;){var o=t.value,i=e.level.transformPoint(o.x,o.y),c=Object(v.a)(i,2),l=c[0],s=c[1];a?n.lineTo(l,s):(n.moveTo(l,s),a=!0)}}catch(p){r.e(p)}finally{r.f()}var u=e.level.transformPoint(e.vertices[0].x,e.vertices[0].y),d=Object(v.a)(u,2),f=d[0],m=d[1];return n.lineTo(f,m),n}),[e.vertices,e.level]),a=o.a.useMemo((function(){var n=new w.Color(1,1,1);return t&&t.uuid===e.floor.uuid&&n.setRGB(1,.4,.1),n}),[t,e.floor.uuid]);return Object(ve.jsxs)("mesh",{position:[0,0,-.1],onClick:function(t){t.stopPropagation(),console.log("floor onClick"),$(e.floor)},children:[Object(ve.jsx)("extrudeGeometry",{args:[n,{depth:.1,bevelEnabled:!1}]}),Object(ve.jsx)("meshStandardMaterial",{color:a})]},e.floor.uuid)}var Ne=n(78);function ze(e){var t=Z((function(e){return e.selection})),n=Z((function(e){return e.site.coordinateSystem}));Z((function(e){return e.repaintCount}));var r,i=Z((function(e){return e.site.graphs})),c=e.vertex_start,l=e.vertex_end,s=e.level.transformPoint((c.x+l.x)/2,(c.y+l.y)/2),u=Object(v.a)(s,2),d=u[0],f=u[1],m=l.x-c.x,p=l.y-c.y,b=Math.sqrt(m*m+p*p)*e.level.scale,h=Math.atan2(p,m),x=e.lane.graph_idx,O=n===a.Legacy?.5:.02,y=Object(j.a)(i);try{for(y.s();!(r=y.n()).done;){var g=r.value;g.id===x&&(O=g.default_lane_width)}}catch(Y){y.e(Y)}finally{y.f()}var _=O/20,M=e.lane.getParam("bidirectional",!1),k=o.a.useRef(),L=o.a.useMemo((function(){return new Float32Array([0,1,.2*b,1,0,0,.2*b,0])}),[b]),C=o.a.useMemo((function(){var n=new w.Color(.6,.05,.05);return t&&t.uuid===e.lane.uuid&&n.setRGB(.8,.3,.01),n}),[t,e.lane.uuid]),S=Object(Se.c)(Ne.a,"/traffic-editor-js/textures/lane_direction3.png");S&&(S.wrapS=w.RepeatWrapping,S.wrapT=w.RepeatWrapping);var A=o.a.useRef(),P=o.a.useCallback((function(e){e.parent.attributes.uv.needsUpdate=!0}),[]);return Object(ve.jsxs)("mesh",{position:[d,f,_+e.elevation],rotation:new w.Euler(0,0,h),scale:1,onClick:function(t){t.stopPropagation(),$(e.lane)},children:[Object(ve.jsx)("meshStandardMaterial",{color:C,transparent:!0,map:M?null:S,opacity:.7}),Object(ve.jsx)("planeBufferGeometry",{args:[b,O,1,1],ref:A,children:Object(ve.jsx)("bufferAttribute",{attachObject:["attributes","uv"],count:4,itemSize:2,array:L,ref:k,onUpdate:P})})]},e.lane.uuid)}function Ve(e){var t=Z((function(e){return e.site.url_base})),n=Object(Se.c)(Ne.a,[t+e.image.filename]),a=Object(v.a)(n,1)[0],r=50,o=50;a&&(a.magFilter=w.NearestFilter,a.minFilter=w.NearestFilter,r=a.image.width*e.level.scale,o=a.image.height*e.level.scale);var i=e.image.offset.x,c=e.image.offset.y,l=e.image.yaw;return Object(ve.jsxs)("mesh",{position:[i+r/2,c-o/2,e.elevation-.05+.01],scale:1,rotation:new w.Euler(0,l,0),children:[Object(ve.jsx)("boxGeometry",{args:[r,o,.1,8]}),Object(ve.jsx)("meshStandardMaterial",{map:a,color:[1,1,1]})]},e.image.uuid)}function Re(e){var t=Z((function(e){return e.selection})),n=e.vertex_start,a=e.vertex_end,r=e.level.transformPoint((n.x+a.x)/2,(n.y+a.y)/2),i=Object(v.a)(r,2),c=i[0],l=i[1],s=a.x-n.x,u=a.y-n.y,d=Math.sqrt(s*s+u*u)*e.level.scale,f=Math.atan2(u,s),m=o.a.useMemo((function(){var n=new w.Color(.6,.1,.6);return t&&t.uuid===e.measurement.uuid&&n.setRGB(.8,.3,.01),n}),[t,e.measurement.uuid]);return Object(ve.jsxs)("mesh",{position:[c,l,.2+e.elevation],rotation:new w.Euler(0,0,f),scale:1,onClick:function(t){t.stopPropagation(),$(e.measurement)},children:[Object(ve.jsx)("boxGeometry",{args:[d,.5,.1]}),Object(ve.jsx)("meshStandardMaterial",{color:m})]},e.measurement.uuid)}function Fe(e){var t=Z((function(e){return e.selection})),n=Z((function(e){return e.set})),a=Z((function(e){return e.editorMode})),r=Z((function(e){return e.activeTool===D.MOVE})),i=o.a.useState(!1),c=Object(v.a)(i,2),l=c[0],s=c[1],u=e.level.transformPoint(e.model.x,e.model.y),d=Object(v.a)(u,2),f=d[0],m=d[1],j="rgb(128, 128, 128)";return t&&t.uuid===e.model.uuid&&(j="rgb(255, 100, 10)"),Object(ve.jsxs)("mesh",{position:[f,m,.25+e.elevation],scale:1,rotation:new w.Euler(Math.PI/2,e.model.yaw,0),onClick:function(t){t.stopPropagation(),$(e.model)},onPointerDown:function(e){r&&(e.stopPropagation(),s(!0),e.target&&e.target.setPointerCapture(e.pointerId))},onPointerUp:function(e){e.stopPropagation(),s(!1),e.target&&e.target.releasePointerCapture(e.pointerId)},onPointerMove:function(t){if(l)if(t.stopPropagation(),"2d"===a){var r=e.level.inverseTransformPoint(t.unprojectedPoint.x,t.unprojectedPoint.y),o=Object(v.a)(r,2),i=o[0],c=o[1];re(n,e.level_uuid,e.model.uuid,i,c)}else{var s=new w.Vector3;t.ray.intersectPlane(new w.Plane(new w.Vector3(0,0,1),e.elevation),s);var u=e.level.inverseTransformPoint(s.x,s.y),d=Object(v.a)(u,2),f=d[0],m=d[1];re(n,e.level_uuid,e.model.uuid,f,m)}},children:[Object(ve.jsx)("boxGeometry",{args:[.4,.4,.4,8]}),Object(ve.jsx)("meshStandardMaterial",{color:j})]},e.model.uuid)}function We(e){var t=Z((function(e){return e.selection})),n=Z((function(e){return e.set})),r=Z((function(e){return e.editorMode})),i=Z((function(e){return e.activeTool})),c=Z((function(e){return e.activeUUID})),l=Z((function(e){return e.activeMotionTool})),s=Z((function(e){return e.site.coordinateSystem})),u=[D.MOVE,D.ADD_LANE,D.ADD_WALL],d=Z((function(e){return e.site})),f=o.a.useState([0,0]),p=Object(v.a)(f,2),b=p[0],h=p[1],x=o.a.useState(!1),O=Object(v.a)(x,2),y=O[0],g=O[1],M=o.a.useCallback((function(e){e.setFromPoints([new w.Vector3(0,0,0),new w.Vector3(b[0],b[1],0)])}),[b]),k=d.getParam("default_vertex_radius",s===a.Legacy?.1:.01),L=e.level.transformPoint(e.vertex.x,e.vertex.y),C=Object(v.a)(L,2),A=C[0],P=C[1],Y="rgb(0, 128, 0)";return t&&t.uuid===e.vertex.uuid&&(Y="rgb(255, 100, 10)"),Object(ve.jsxs)("group",{children:[Object(ve.jsxs)("mesh",{position:[A,P,k/2+e.elevation],scale:1,rotation:new w.Euler(Math.PI/2,0,0),onClick:function(e){e.stopPropagation()},onPointerDown:function(t){var n;i!==D.SELECT?u.includes(i)&&(t.stopPropagation(),ne(i),n=e.vertex.uuid,Z.setState({activeUUID:n}),t.target&&t.target.setPointerCapture(t.pointerId)):$(e.vertex)},onPointerUp:function(t){t.stopPropagation(),t.target&&t.target.releasePointerCapture(t.pointerId),g(!1),ae(n),l===D.ADD_LANE?c!==e.vertex.uuid&&function(e,t,n){console.log("addLane(".concat(e,", ").concat(t,")"));var a,r=Z.getState().site,o=Object(j.a)(r.levels);try{for(o.s();!(a=o.n()).done;){var i=a.value;if(i.uuid===n){for(var c=-1,l=-1,s=0;s<i.vertices.length;s++)i.vertices[s].uuid===e&&(c=s),i.vertices[s].uuid===t&&(l=s);if(c<0||l<0)return;var u=new S;u.uuid=Object(_.a)(),u.start_idx=c,u.end_idx=l,u.addDefaultParams(),i.lanes=[].concat(Object(m.a)(i.lanes),[u]);break}}}catch(d){o.e(d)}finally{o.f()}Z.setState({site:r,repaintCount:Z.getState().repaintCount+1})}(c,e.vertex.uuid,e.level.uuid):l===D.ADD_WALL&&c!==e.vertex.uuid&&function(e,t,n){console.log("addWall(".concat(e,", ").concat(t,")"));var a,r=Z.getState().site,o=Object(j.a)(r.levels);try{for(o.s();!(a=o.n()).done;){var i=a.value;if(i.uuid===n){for(var c=-1,l=-1,s=0;s<i.vertices.length;s++)i.vertices[s].uuid===e&&(c=s),i.vertices[s].uuid===t&&(l=s);if(c<0||l<0)return;var u=new G;u.uuid=Object(_.a)(),u.start_idx=c,u.end_idx=l,u.addDefaultParams(),i.walls=[].concat(Object(m.a)(i.walls),[u]);break}}}catch(d){o.e(d)}finally{o.f()}Z.setState({site:r,repaintCount:Z.getState().repaintCount+1})}(c,e.vertex.uuid,e.level.uuid),ne(D.NONE)},onPointerMove:function(t){if(l!==D.NONE){t.stopPropagation();var a=0,o=0;if("2d"===r){var i=e.level.inverseTransformPoint(t.unprojectedPoint.x,t.unprojectedPoint.y),c=Object(v.a)(i,2);a=c[0],o=c[1]}else{if("3d"!==r)return;var s=new w.Vector3;t.ray.intersectPlane(new w.Plane(new w.Vector3(0,0,1),e.elevation),s);var u=e.level.inverseTransformPoint(s.x,s.y),d=Object(v.a)(u,2);a=d[0],o=d[1]}l===D.MOVE?function(e,t,n,a,r){e((function(e){e.site.levels.map((function(e){return e.uuid===t&&e.vertices.map((function(e){return e.uuid===n&&(e.x=a,e.y=r),e})),e})),e.repaintCount=e.repaintCount+1}))}(n,e.level_uuid,e.vertex.uuid,a,o):(l===D.ADD_LANE||l===D.ADD_WALL)&&(g(!0),h([a-A,o-P]))}},children:[Object(ve.jsx)("cylinderGeometry",{args:[k,k,k,16]}),Object(ve.jsx)("meshStandardMaterial",{color:Y})]},e.vertex.uuid),Object(ve.jsx)(De.a,{color:"blue",position:[A,P,1.5*k+e.elevation],fontSize:1*k,children:e.vertex.name}),y&&Object(ve.jsxs)("lineSegments",{position:[A,P,e.elevation+.3],children:[Object(ve.jsx)("bufferGeometry",{attach:"geometry",onUpdate:M}),Object(ve.jsx)("lineBasicMaterial",{attach:"material",color:"#000000",linewidth:20,linecap:"round"})]})]})}function Be(e){var t=Z((function(e){return e.selection})),n=e.vertex_start,r=e.vertex_end,i=e.level.transformPoint((n.x+r.x)/2,(n.y+r.y)/2),c=Object(v.a)(i,2),l=c[0],s=c[1],u=r.x-n.x,d=r.y-n.y,f=Math.sqrt(u*u+d*d)*e.level.scale,m=Math.atan2(d,u),j=Z((function(e){return e.site.coordinateSystem}))===a.Legacy?.1:.01,p=20*j,b=o.a.useMemo((function(){var n=new w.Color(.1,.1,.9);return t&&t.uuid===e.wall.uuid&&n.setRGB(1,.4,.1),n}),[t,e.wall.uuid]);return Object(ve.jsxs)("mesh",{position:[l,s,e.elevation],rotation:new w.Euler(0,0,m),scale:1,onClick:function(t){t.stopPropagation(),$(e.wall)},children:[Object(ve.jsx)("boxGeometry",{args:[f,j,p]}),Object(ve.jsx)("meshStandardMaterial",{color:b})]},e.wall.uuid)}function Ue(e){var t=e.level.elevation/2;return Z((function(e){return e.selection})),Object(ve.jsxs)("group",{children:[e.level.models.map((function(n){return Object(ve.jsx)(Fe,{model:n,level:e.level,level_uuid:e.level.uuid,elevation:t},n.uuid)})),e.level.vertices.map((function(n){return Object(ve.jsx)(We,{vertex:n,level:e.level,level_uuid:e.level.uuid,elevation:t},n.uuid)})),e.level.features.map((function(n){return Object(ve.jsx)(Te,{feature:n,level:e.level,elevation:t},n.uuid)})),e.level.walls.map((function(n){return Object(ve.jsx)(Be,{wall:n,level:e.level,vertex_start:e.level.vertices[n.start_idx],vertex_end:e.level.vertices[n.end_idx],elevation:t},n.uuid)})),e.level.doors.map((function(n){return Object(ve.jsx)(Ee,{door:n,level:e.level,vertex_start:e.level.vertices[n.start_idx],vertex_end:e.level.vertices[n.end_idx],elevation:t},n.uuid)})),e.level.floors.map((function(n){return Object(ve.jsx)(Ie,{floor:n,level:e.level,vertices:n.vertex_indices.map((function(t){return e.level.vertices[t]})),elevation:t},n.uuid)})),Object(ve.jsxs)(r.Suspense,{fallback:null,children:[e.level.lanes.map((function(n){return Object(ve.jsx)(ze,{lane:n,level:e.level,vertex_start:e.level.vertices[n.start_idx],vertex_end:e.level.vertices[n.end_idx],elevation:t},n.uuid)})),e.level.images.filter((function(e){return e.isLegacyDefaultImage})).map((function(n){return Object(ve.jsx)(Ve,{image:n,level:e.level,elevation:t},n.uuid)}))]}),e.level.measurements.map((function(n){return Object(ve.jsx)(Re,{measurement:n,level:e.level,vertex_start:e.level.vertices[n.start_idx],vertex_end:e.level.vertices[n.end_idx],elevation:t},n.uuid)}))]})}function Ge(e){var t=new w.Color(0,.8,.8),n=new w.Color(0,.5,.5),a=new w.Color(0,.5,.5),r=.008,o=.015,i=e.telemetry.heading,c=e.telemetry.x,l=e.telemetry.y,s=e.telemetry.z,u=c+.004*Math.cos(i),d=l+.004*Math.sin(i);return Object(ve.jsxs)("group",{children:[Object(ve.jsxs)("mesh",{position:[c,l,s+.0075],rotation:new w.Euler(Math.PI/2,0,0),scale:1,children:[Object(ve.jsx)("cylinderGeometry",{args:[r,r,o,16]}),Object(ve.jsx)("meshStandardMaterial",{color:t})]},e.telemetry.name),Object(ve.jsxs)("mesh",{position:[u,d,s+.0165],rotation:new w.Euler(0,0,i),scale:1,children:[Object(ve.jsx)("planeGeometry",{args:[r,.002]}),Object(ve.jsx)("meshStandardMaterial",{color:n})]},e.telemetry.name+"_pointer"),Object(ve.jsx)(De.a,{fontSize:r/3,color:a,position:[c,l+.004,s+o+.001],children:e.telemetry.name})]})}function He(e){var t=Z((function(e){return e.site}));Z((function(e){return e.selection})),Z((function(e){return e.repaintCount}));var n=Z((function(e){return e.set})),r=Z((function(e){return e.mqtt_robot_telemetry}));return Object(Se.d)((function(e){return e.scene})).background=new w.Color("white"),Object(Se.b)((function(e){if(e.camera instanceof w.OrthographicCamera){var t=e.camera,a=t.matrixWorld.elements[12],r=t.matrixWorld.elements[13],o=t.matrixWorld.elements[14];n((function(e){e.cameraPose={position:e.cameraPose.position.set(a,r,o),target:e.cameraPose.target,zoom:e.cameraPose.zoom}}))}})),Object(ve.jsxs)("group",{children:[t.coordinateSystem===a.Legacy&&Object(ve.jsx)("pointLight",{position:[10,10,10]}),t.levels.map((function(e){return Object(ve.jsx)(Ue,{level:e},e.uuid)})),r.map((function(e){return Object(ve.jsx)(Ge,{telemetry:e})}))]})}function qe(e){var t=Z((function(e){return e.activeTool})),n=Z((function(e){return e.editorMode})),r="".concat(e.zoom,"_").concat(e.x,"_").concat(e.y),i=1e3,c=256e3/Math.pow(2,e.zoom),l=256*e.x*i/Math.pow(2,e.zoom)+c/2,s=-1*(256*e.y*i/Math.pow(2,e.zoom)+c/2),u="https://tiles.demo.open-rmf.org/tiles/".concat(e.zoom,"/").concat(e.x,"/").concat(e.y,".png"),d=o.a.useState(),f=Object(v.a)(d,2),j=f[0],p=f[1];return o.a.useEffect((function(){(new Ne.a).load(u,p)}),[u]),j&&18===e.zoom&&(j.magFilter=w.NearestFilter),Object(ve.jsx)("group",{children:Object(ve.jsxs)("mesh",{position:[l,s,-.05],scale:1,rotation:new w.Euler(0,0,0),onPointerDown:function(e){e.stopPropagation(),t===D.ADD_VERTEX&&"2d"===n&&function(e,t){console.log("addVertex(".concat(e,", ").concat(t,")"));var n=new A;n.uuid=Object(_.a)(),n.x=e,n.y=t,n.addDefaultParams();var r=Z.getState().site;if(0===r.levels.length){var o=new T;o.uuid=Object(_.a)(),o.coordinateSystem=r.coordinateSystem,o.name="default",o.scale=r.coordinateSystem===a.Legacy?.05:1,n.x*=o.scale,n.y*=o.scale,o.vertices=[n],r.levels=[o]}else{var i=r.levels[0];n.x*=i.scale,n.y*=i.scale,i.vertices=[].concat(Object(m.a)(i.vertices),[n])}Z.setState({site:r,repaintCount:Z.getState().repaintCount+1})}(e.unprojectedPoint.x,e.unprojectedPoint.y)},children:[Object(ve.jsx)("boxGeometry",{args:[c,c,.1,8]}),Object(ve.jsx)("meshStandardMaterial",{map:j,color:[1,1,1]},j?"texture":"notexture")]},r)})}function Xe(e,t,n){return e<t?t:e>n?n:e}function Je(e){var t=o.a.useState([]),n=Object(v.a)(t,2),a=n[0],r=n[1],i=Object(Se.d)((function(e){return e.viewport})),c=Object(Se.d)((function(e){return e.camera})),l=Object(Se.d)((function(e){return e.size})),s=Object(Se.d)((function(e){return e.performance.current}));return o.a.useEffect((function(){if(1===s&&c instanceof w.OrthographicCamera){var e=c,t=c.matrixWorld.elements[12],n=c.matrixWorld.elements[13],a=t+e.right/e.zoom,o=t+e.left/e.zoom,i=-(n+e.top/e.zoom),l=-(n+e.bottom/e.zoom),u=Math.ceil(1.5+Math.log(256e3/(a-o))/Math.log(2));u<0?u=0:u>18&&(u=18),O=u<17,Z.getState().disableEditorTools!==O&&Z.setState({disableEditorTools:O});var d=Math.floor(o/256e3*Math.pow(2,u)),f=Math.floor(a/256e3*Math.pow(2,u)),m=Math.floor(i/256e3*Math.pow(2,u)),v=Math.floor(l/256e3*Math.pow(2,u)),j=Math.pow(2,u)-1;d=Xe(d,0,j),f=Xe(f,0,j),m=Xe(m,0,j),v=Xe(v,0,j);for(var p=Array(),b=m;b<=v;b++)for(var h=d;h<=f;h++){var x={x:h,y:b,zoom:u,visible:!0};p.push(x)}r(p),console.log("setTiles()")}var O}),[s,c,i,l]),Object(ve.jsx)("group",{children:a.map((function(e){return Object(ve.jsx)(qe,{x:e.x,y:e.y,zoom:e.zoom},"".concat(e.zoom,"_").concat(e.x,"_").concat(e.y))}))})}function Ke(e){var t=Object(Se.d)((function(e){return e.gl.domElement})),n=Z((function(e){return e.set}));return o.a.useEffect((function(){t.tabIndex=42;var e=function(e){if(void 0!==e.key){var t=e.key.toLowerCase();"m"===t?(te(D.MOVE),ee(n)):"escape"===t?(te(D.SELECT),ee(n)):"v"===t?(te(D.ADD_VERTEX),ee(n)):"l"===t&&(te(D.ADD_LANE),ee(n))}};return t.addEventListener("keydown",e),function(){t.removeEventListener("keydown",e)}}),[t,n]),Object(ve.jsx)(ve.Fragment,{})}function Qe(e){var t=Z((function(e){return e.site.coordinateSystem===a.WebMercator})),n=Z((function(e){return e.set})),o=Z((function(e){return e.editorMode})),i=function(){w.Object3D.DefaultUp=new w.Vector3(0,0,1);var e=Z((function(e){return e.cameraInitialPose})),t=Object(r.useRef)(null),n=Object(r.useRef)(null),a=Z((function(e){return e.enableMotionControls}));return Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)(Pe.a,{ref:t,position:e.position,fov:60,makeDefault:"3d"===o}),Object(ve.jsx)(Ye.a,{ref:n,position:[e.target.x,e.target.y,e.target.z+100],zoom:e.zoom,makeDefault:"2d"===o}),t&&n&&Object(ve.jsx)(Ae.a,{enableDamping:!1,screenSpacePanning:"3d"!==o,target:e.target,camera:"3d"===o?t.current:n.current,maxPolarAngle:"3d"===o?1/0:0,minAzimuthAngle:"3d"===o?-1/0:0,maxAzimuthAngle:"3d"===o?1/0:0,mouseButtons:{LEFT:w.MOUSE.PAN,MIDDLE:-1,RIGHT:w.MOUSE.ROTATE},touches:{ONE:w.TOUCH.PAN,TWO:w.TOUCH.ROTATE},enabled:a,regress:!0})]})};return console.log("EditorScene()"),Object(ve.jsxs)(Se.a,{id:"mainCanvas",frameloop:"demand",mode:"concurrent",linear:!0,tabIndex:0,onPointerMissed:function(){ee(n)},children:[Object(ve.jsx)(Ke,{}),Object(ve.jsx)(i,{}),Object(ve.jsx)("axesHelper",{}),Object(ve.jsx)("ambientLight",{intensity:1}),Object(ve.jsx)(He,{}),t&&Object(ve.jsx)(Je,{})]})}var Ze=n(308),$e=n(309),et=n(311),tt=n(310),nt=n(312),at=n(329),rt=n(326);function ot(e){var t=o.a.useState(e.param.value),n=Object(v.a)(t,2),a=n[0],r=n[1],i=o.a.useState(e.param.value),c=Object(v.a)(i,2),l=c[0],s=c[1],u=Z((function(e){return e.selection})),d=o.a.useRef();o.a.useEffect((function(){r(e.param.value),s(e.param.value)}),[u,e.param]);return 4===e.param.type_idx?Object(ve.jsx)(at.a,{color:"primary",id:e.param.name+"_checkbox",checked:a,onChange:function(t){r(t.target.checked),e.param.value=t.target.checked,Z.setState({site:Z.getState().site,repaintCount:Z.getState().repaintCount+1})}}):1===e.param.type_idx?Object(ve.jsx)("div",{children:Object(ve.jsx)(rt.a,{id:e.param.name+"_string_field",inputRef:d,variant:"outlined",margin:"dense",value:l,onChange:function(t){s(t.target.value),e.param.value=t.target.value,Z.setState({site:Z.getState().site,repaintCount:Z.getState().repaintCount+1})}})}):Object(ve.jsx)("div",{children:e.param.value.toString()})}function it(e){var t=Z((function(e){return e.selection})),n=o.a.useRef(),a=o.a.useState(e.prop.get_value()),r=Object(v.a)(a,2),i=r[0],c=r[1];o.a.useEffect((function(){c(e.prop.get_value())}),[t,e.prop]);return e.prop.canModify?Object(ve.jsx)(rt.a,{id:"field",inputRef:n,variant:"outlined",margin:"dense",value:i,onChange:function(t){e.prop.canModify&&(c(t.target.value),e.prop.set_value(t.target.value),Z.setState({site:Z.getState().site,repaintCount:Z.getState().repaintCount+1}))}}):Object(ve.jsx)("div",{children:e.prop.get_value()})}var ct=Object(l.a)((function(e){return{noSelectionDiv:{},table:{padding:"0px",margin:"0px"},tableHead:{},tableHeadRow:{borderBottomStyle:"solid",borderBottom:"1px",borderBottomColor:e.palette.primary.main},tableHeadCell:{fontWeight:"bold",padding:"0px",paddingLeft:"5px"},tableCell:{padding:"0px",paddingLeft:"5px"}}}));function lt(){var e=ct(),t=Z((function(e){return e.selection}));return Z((function(e){return e.propertyRepaintCount})),t?Object(ve.jsxs)(Ze.a,{className:e.table,children:[Object(ve.jsxs)($e.a,{children:[Object(ve.jsx)(tt.a,{className:e.tableHeadCell,children:t.object_type_name}),Object(ve.jsx)(tt.a,{className:e.tableHeadCell})]}),Object(ve.jsxs)(et.a,{children:[t.props.map((function(t){return Object(ve.jsxs)(nt.a,{children:[Object(ve.jsx)(tt.a,{className:e.tableCell,children:t.name}),Object(ve.jsx)(tt.a,{className:e.tableCell,children:Object(ve.jsx)(it,{prop:t})},t.name+"_control")]})})),t.params.map((function(t){return Object(ve.jsxs)(nt.a,{children:[Object(ve.jsx)(tt.a,{className:e.tableCell,children:t.name}),Object(ve.jsx)(tt.a,{className:e.tableCell,children:Object(ve.jsx)(ot,{param:t})},t.name+"_control")]})}))]})]}):Object(ve.jsx)("div",{className:e.noSelectionDiv})}var st=n(320),ut=n(323),dt=n(321),ft=n(337),mt=n(303),vt=n(324),jt=n(336),pt=n(160),bt=n.n(pt),ht=n(170),xt=n(322),Ot=n(314),yt=n(315),gt=n(333),wt=n(327),_t=n(89),Mt=n(16),kt=n(157),Lt=n(334),Ct=n(316),St=n(317),At=n(319),Pt=n(306),Yt=n(313),Et=n(247),Dt=n(158),Tt=n.n(Dt),It=n(318),Nt=Object(l.a)((function(e){return{directoryButton:{fontSize:e.typography.h5.fontSize},filename:{fontSize:e.typography.h5.fontSize,textDecoration:"underline"},dialog:{backgroundColor:e.palette.background.paper}}}));function zt(e){var t=Nt(e),n=o.a.useState([]),a=Object(v.a)(n,2),r=a[0],i=a[1],c=o.a.useState(),l=Object(v.a)(c,2),s=l[0],u=l[1],j=function(){var e=Object(f.a)(d.a.mark((function e(){var t,n,a,r,o,c,l,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i([]),e.next=3,window.showDirectoryPicker();case 3:return t=e.sent,e.next=6,u(t);case 6:n=!0,a=!1,e.prev=8,o=function(){var e=s;e.name.endsWith(".building.yaml")&&i((function(t){return[].concat(Object(m.a)(t),[e.name])}))},c=Object(kt.a)(t.values());case 11:return e.next=13,c.next();case 13:return l=e.sent,n=l.done,e.next=17,l.value;case 17:if(s=e.sent,n){e.next=23;break}o();case 20:n=!0,e.next=11;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(8),a=!0,r=e.t0;case 29:if(e.prev=29,e.prev=30,n||null==c.return){e.next=34;break}return e.next=34,c.return();case 34:if(e.prev=34,!a){e.next=37;break}throw r;case 37:return e.finish(34);case 38:return e.finish(29);case 39:case"end":return e.stop()}}),e,null,[[8,25,29,39],[30,,34,38]])})));return function(){return e.apply(this,arguments)}}(),p=function(){var t=Object(f.a)(d.a.mark((function t(n){var a,r,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=15;break}return t.next=3,s.getFileHandle(n);case 3:return a=t.sent,t.next=6,a.getFile();case 6:return r=t.sent,t.next=9,r.text();case 9:z(t.sent,""),(o=Z.getState().site).filename=n,o.save=Object(f.a)(d.a.mark((function e(){var t,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getFileHandle(n,{create:!0});case 2:return t=e.sent,e.next=5,t.createWritable();case 5:return a=e.sent,Object.getPrototypeOf(M.a.YAMLMap).maxFlowStringSingleLineLength=1e4,e.next=9,a.write(o.toYAMLString());case 9:return e.next=11,a.close();case 11:case"end":return e.stop()}}),e)}))),Z.setState({site:o});case 15:e.onOpen();case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(ve.jsxs)(Lt.a,{open:e.open,onClose:e.onCancel,children:[Object(ve.jsx)(Ct.a,{children:"Open Building Map"}),Object(ve.jsxs)(St.a,{className:t.dialog,children:[Object(ve.jsx)(It.a,{variant:"contained",color:"primary",onClick:j,children:"Select Directory..."}),function(){if(r.length>0)return Object(ve.jsx)("div",{children:Object(ve.jsx)(Pt.a,{subheader:Object(ve.jsx)(Yt.a,{component:"div",children:"Available Files"}),children:r.map((function(e){return Object(ve.jsxs)(Et.a,{button:!0,children:[Object(ve.jsx)(Ot.a,{children:Object(ve.jsx)(Tt.a,{})}),Object(ve.jsx)(yt.a,{primary:e,onClick:function(t){p(e)}})]},e)}))})})}()]}),Object(ve.jsx)(At.a,{children:Object(ve.jsx)(It.a,{onClick:e.onCancel,color:"primary",children:"Cancel"})})]})}var Vt=Object(l.a)((function(e){return{directoryButton:{fontSize:e.typography.h5.fontSize},filename:{fontSize:e.typography.h5.fontSize,textDecoration:"underline"},dialog:{backgroundColor:e.palette.background.paper,"& .MuiTextField-root":{margin:e.spacing(1),width:"25ch"}}}}));function Rt(e){var t=Vt(e),n=o.a.useState(),a=Object(v.a)(n,2),i=a[0],c=a[1],l=Object(r.useRef)(),s=function(){var e=Object(f.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.showDirectoryPicker({writable:!0});case 2:t=e.sent,c(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u="function"===typeof window.showDirectoryPicker;return Object(ve.jsxs)(Lt.a,{open:e.open,onClose:e.onCancel,children:[Object(ve.jsx)(Ct.a,{children:"New Site Map"}),Object(ve.jsx)(St.a,{className:t.dialog,children:u?Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)("div",{children:Object(ve.jsx)(It.a,{variant:"contained",color:"primary",onClick:s,children:"Select Directory..."})}),Object(ve.jsx)("div",{children:Object(ve.jsx)(rt.a,{id:"site-name",inputRef:l,variant:"outlined",label:"Site Name"})})]}):Object(ve.jsx)("div",{children:"Unfortunately, this browser does not support the File System Access API."})}),Object(ve.jsx)(At.a,{children:Object(ve.jsxs)(ve.Fragment,{children:[u?Object(ve.jsx)(It.a,{onClick:function(){if(i){var t,n,a=N.fromNewCommand();if(l.current)a.name=null===(t=l.current)||void 0===t?void 0:t.value,a.filename=(null===(n=l.current)||void 0===n?void 0:n.value)+".building.yaml",a.save=Object(f.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.getFileHandle(a.filename,{create:!0});case 2:return t=e.sent,e.next=5,t.createWritable();case 5:return n=e.sent,Object.getPrototypeOf(M.a.YAMLMap).maxFlowStringSingleLineLength=1e4,e.next=9,n.write(a.toYAMLString());case 9:return e.next=11,n.close();case 11:case"end":return e.stop()}}),e)})));var r=a.computeInitialCameraPose();Z.setState({site:a,selection:null,cameraInitialPose:r}),e.close()}},color:"primary",children:"OK"}):Object(ve.jsx)(ve.Fragment,{}),Object(ve.jsx)(It.a,{onClick:e.onCancel,color:"primary",children:"Cancel"})]})})]})}var Ft=n(159),Wt=n.n(Ft),Bt=Object(l.a)((function(e){return{dialog:{backgroundColor:e.palette.background.paper,"& .MuiTextField-root":{margin:e.spacing(1),width:"25ch"}}}}));function Ut(e){var t=Bt(e),n=Object(r.useRef)(),a=Object(r.useRef)();return Object(ve.jsxs)(Lt.a,{open:e.open,onClose:e.close,children:[Object(ve.jsx)(Ct.a,{children:"MQTT Connection"}),Object(ve.jsxs)(St.a,{className:t.dialog,children:[Object(ve.jsx)("div",{children:Object(ve.jsx)(rt.a,{id:"broker-host",inputRef:n,variant:"outlined",label:"Broker Host",defaultValue:"localhost"})}),Object(ve.jsx)("div",{children:Object(ve.jsx)(rt.a,{id:"broker-port",inputRef:a,type:"number",variant:"outlined",label:"Broker Port",defaultValue:"9001"})})]}),Object(ve.jsxs)(At.a,{children:[Object(ve.jsx)(It.a,{onClick:function(){var t=Wt.a.connect("ws://localhost:9001");t.on("connect",(function(){console.log("MQTT connected!"),t.subscribe("/robots/#")})),t.on("message",(function(e,t,n){var a=e.split("/");if(4===a.length&&"robots"===a[1]&&"state"===a[3]){var r=a[2],o={};try{o=JSON.parse(t.toString())}catch(v){console.log("unable to parse: "+t.toString())}if("latitude"in o&&"longitude"in o){var i=256e3*(o.longitude+180)/360,c=o.latitude*Math.PI/180,l=-(128e3-256e3*Math.log(Math.tan(Math.PI/4+c/2))/(2*Math.PI)),s=0;"heading"in o&&(s=o.heading);var u=Z.getState().mqtt_robot_telemetry,d=!1;if(u=u.map((function(e){if(e.name===r){var t={name:e.name,x:i,y:l,z:0,heading:s};return d=!0,t}return e})),!d){var f={name:r,x:i,y:l,z:0,heading:s};u=[].concat(Object(m.a)(u),[f])}Z.setState({mqtt_robot_telemetry:u})}}})),Z.setState({mqtt_client:t}),e.close()},color:"primary",children:"OK"}),Object(ve.jsx)(It.a,{onClick:e.close,color:"primary",children:"Cancel"})]})]})}var Gt=n(165),Ht=n.n(Gt),qt=n(164),Xt=n.n(qt),Jt=n(162),Kt=n.n(Jt),Qt=n(121),Zt=n.n(Qt),$t=n(108),en=n.n($t),tn=n(161),nn=n.n(tn),an=n(169),rn=n.n(an),on=n(166),cn=n.n(on),ln=n(167),sn=n.n(ln),un=n(168),dn=n.n(un),fn=Object(Mt.a)((function(e){return{root:{backgroundColor:e.palette.primary.light,padding:e.spacing(.5),marginRight:5},grouped:{color:e.palette.primary.contrastText,"&.Mui-selected:hover, &:hover":{background:e.palette.primary.dark},"&.Mui-selected":{background:e.palette.primary.dark,color:e.palette.primary.contrastText}}}}))(jt.a),mn=Object(l.a)((function(e){return{flex:{flex:1},menuButton:{marginLeft:-12,marginRight:20},appTitle:{marginRight:20},filler:{flex:1}}}));function vn(e){var t=mn(e),n=o.a.useState(null),a=Object(v.a)(n,2),r=a[0],i=a[1],c=o.a.useState(!1),l=Object(v.a)(c,2),s=l[0],u=l[1],m=o.a.useState(!1),j=Object(v.a)(m,2),p=j[0],b=j[1],h=o.a.useState(!1),x=Object(v.a)(h,2),O=x[0],y=x[1],g=o.a.useState(!1),_=Object(v.a)(g,2),M=_[0],k=_[1],L=o.a.useState(""),C=Object(v.a)(L,2),S=C[0],A=C[1],P=Z((function(e){return e.set})),Y=Z((function(e){return e.editorMode})),E=Z((function(e){return e.activeTool})),T=Z((function(e){return e.disableEditorTools}));o.a.useEffect((function(){var e=function(e){if(void 0!==e.key)return"s"===e.key.toLowerCase()&&e.ctrlKey?(e.preventDefault(),ie(),!1):void 0};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[]);var I=function(){k(!1)};return o.a.useEffect((function(){P((function(e){e.enableMotionControls=E===D.SELECT}))}),[E,P]),Object(ve.jsxs)(st.a,{position:"fixed",children:[Object(ve.jsxs)(dt.a,{children:[Object(ve.jsx)(mt.a,{className:t.menuButton,color:"inherit","aria-label":"Menu",onClick:function(e){i(e.currentTarget)},children:Object(ve.jsx)(bt.a,{})}),Object(ve.jsxs)(ht.a,{keepMounted:!0,anchorEl:r,open:Boolean(r),onClose:function(){return i(null)},getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},transitionDuration:0,children:[Object(ve.jsxs)(xt.a,{onClick:function(){b(!0),Z.setState({mapType:"local_file"}),i(null)},children:[Object(ve.jsx)(Ot.a,{children:Object(ve.jsx)(Zt.a,{})}),Object(ve.jsx)(yt.a,{children:"New site map..."})]}),Object(ve.jsxs)(xt.a,{onClick:function(){var e=N.fromNewCommand(),t=e.computeInitialCameraPose();Z.setState({site:e,selection:null,cameraInitialPose:t}),i(null)},children:[Object(ve.jsx)(Ot.a,{children:Object(ve.jsx)(Zt.a,{})}),Object(ve.jsx)(yt.a,{children:"New geo-located site"})]}),Object(ve.jsx)(ut.a,{}),Object(ve.jsxs)(xt.a,{onClick:Object(f.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V("http://localhost:8000/","map_file");case 3:Z.setState({mapType:"local_rest"}),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),A("could not open file from localhost:8000"),k(!0);case 10:i(null);case 11:case"end":return e.stop()}}),e,null,[[0,6]])}))),children:[Object(ve.jsx)(Ot.a,{children:Object(ve.jsx)(en.a,{})}),Object(ve.jsx)(yt.a,{children:"Open map from localhost:8000"})]}),Object(ve.jsxs)(xt.a,{onClick:Object(f.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F("office");case 2:Z.setState({mapType:"demo"}),i(null);case 4:case"end":return e.stop()}}),e)}))),children:[Object(ve.jsx)(Ot.a,{children:Object(ve.jsx)(en.a,{})}),Object(ve.jsx)(yt.a,{children:"Open demo map"})]}),Object(ve.jsxs)(xt.a,{onClick:function(){u(!0),Z.setState({mapType:"local_file"}),i(null)},children:[Object(ve.jsx)(Ot.a,{children:Object(ve.jsx)(en.a,{})}),Object(ve.jsx)(yt.a,{children:"Open map from local file..."})]}),Object(ve.jsx)(ut.a,{}),Object(ve.jsxs)(xt.a,{onClick:function(){ie(),i(null)},children:[Object(ve.jsx)(Ot.a,{children:Object(ve.jsx)(nn.a,{})}),Object(ve.jsx)(yt.a,{children:"Save"})]}),Object(ve.jsx)(ut.a,{}),Object(ve.jsxs)(xt.a,{onClick:function(){y(!0),i(null)},children:[Object(ve.jsx)(Ot.a,{children:Object(ve.jsx)(Kt.a,{})}),Object(ve.jsx)(yt.a,{children:"Connect MQTT..."})]})]}),Object(ve.jsx)(_t.a,{variant:"h6",color:"inherit",className:t.appTitle,children:"Traffic Editor"}),Object(ve.jsx)("div",{className:t.filler}),Object(ve.jsxs)(fn,{value:E,size:"small",exclusive:!0,onChange:function(e,t){null!==t&&(te(t),ee(P))},"aria-label":"tool",children:[Object(ve.jsx)(vt.a,{value:D.SELECT,children:Object(ve.jsx)(ft.a,{title:"Select tool [Escape]",children:Object(ve.jsx)(Xt.a,{})})}),Object(ve.jsx)(vt.a,{value:D.MOVE,disabled:T,children:Object(ve.jsx)(ft.a,{title:"Move tool [M]",children:Object(ve.jsx)(Ht.a,{})})}),Object(ve.jsx)(vt.a,{value:D.ADD_VERTEX,disabled:T,children:Object(ve.jsx)(ft.a,{title:"Add vertex [V]",children:Object(ve.jsx)(cn.a,{})})}),Object(ve.jsx)(vt.a,{value:D.ADD_LANE,disabled:T,children:Object(ve.jsx)(ft.a,{title:"Add lane [L]",children:Object(ve.jsx)(sn.a,{})})}),Object(ve.jsx)(vt.a,{value:D.ADD_WALL,disabled:T,children:Object(ve.jsx)(ft.a,{title:"Add wall [W]",children:Object(ve.jsx)(dn.a,{})})})]}),Object(ve.jsxs)(fn,{value:Y,size:"small",exclusive:!0,onChange:function(e,t){null!==t&&("2d"===Y&&P((function(e){e.cameraInitialPose={position:new w.Vector3(e.cameraPose.position.x+2,e.cameraPose.position.y-2,10),target:new w.Vector3(e.cameraPose.position.x,e.cameraPose.position.y,0),zoom:20}})),function(e,t){e((function(e){e.editorMode=t}))}(P,t),ee(P))},"aria-label":"editor mode",children:[Object(ve.jsx)(vt.a,{value:"3d",children:"3D"}),Object(ve.jsx)(vt.a,{value:"2d",children:"2D"})]})]}),Object(ve.jsx)(Rt,{open:p,onNew:function(){},onCancel:function(){return b(!1)},close:function(){return b(!1)}}),Object(ve.jsx)(zt,{open:s,onOpen:function(){return u(!1)},onCancel:function(){return u(!1)}}),Object(ve.jsx)(Ut,{open:O,close:function(){return y(!1)}}),Object(ve.jsx)(gt.a,{anchorOrigin:{vertical:"top",horizontal:"left"},open:M,onClose:I,autoHideDuration:2e3,transitionDuration:0,TransitionProps:{appear:!1},action:Object(ve.jsx)(o.a.Fragment,{children:Object(ve.jsx)(mt.a,{onClick:I,children:Object(ve.jsx)(rn.a,{})})}),children:Object(ve.jsx)(wt.a,{elevation:6,variant:"filled",severity:"error",onClose:I,children:S})})]})}var jn=Object(l.a)((function(e){return{root:{flexGrow:1,minHeight:"100vh"},flex:{flex:1},menuButton:{marginLeft:-12,marginRight:20},toolbarMargin:e.mixins.toolbar,workingArea:{backgroundColor:"black",height:"calc(100vh - 64px)"},gridLeftColumn:{borderRight:"5px",borderRightStyle:"solid",borderRightColor:e.palette.primary.main},propertyGridItem:{borderTop:"5px",borderTopStyle:"solid",borderTopColor:e.palette.primary.main}}}));function pn(e){var t=jn(e);return Object(ve.jsxs)("div",{className:t.root,children:[Object(ve.jsx)(vn,{}),Object(ve.jsx)("div",{className:t.toolbarMargin}),Object(ve.jsxs)(s.a,{container:!0,spacing:0,children:[Object(ve.jsxs)(s.a,{className:t.gridLeftColumn,container:!0,xs:3,direction:"column",spacing:0,children:[Object(ve.jsx)(s.a,{item:!0,style:{height:"40vh",overflow:"auto"},children:Object(ve.jsx)(Ce,{})}),Object(ve.jsx)(s.a,{item:!0,className:t.propertyGridItem,style:{height:"50vh",overflow:"auto"},children:Object(ve.jsx)(lt,{})})]}),Object(ve.jsx)(s.a,{item:!0,xs:9,className:t.workingArea,children:Object(ve.jsx)(Qe,{})})]})]})}c.a.render(Object(ve.jsx)(o.a.StrictMode,{children:Object(ve.jsx)(pn,{})}),document.getElementById("root"))}},[[245,1,2]]]);
//# sourceMappingURL=main.a54a608d.chunk.js.map