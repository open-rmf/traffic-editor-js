(this["webpackJsonptraffic-editor-pwa"]=this["webpackJsonptraffic-editor-pwa"]||[]).push([[0],{110:function(e,n,t){},125:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(23),i=t.n(c),o=(t(110),t(10)),s=t.n(o),l=t(39),u=t(19),j=t(166),d=t(178),x=t(179),b=t(61),f=t(180),p=t(98),h=t.n(p),v=t(184),O=t(181),m=t(182),g=t(25),y=t(91),w=t(185),k=t(173),C=t(174),S=t(176),M=t(168),_=t(170),I=t(126),E=t(171),B=t(172),N=t(93),z=t.n(N),D=t(175),A=t(9),G=t(99),H=function(e){if(!e)return[];var n=[];for(var t in e){var a=e[t],r={name:t,type_idx:a[0],value:a[1]};n.push(r)}return n},P=function(e){return{x:e[0],y:-e[1],name:e[3],params:H(e[4])}},F=function(e){return{start_idx:e[0],end_idx:e[1],params:H(e[2])}},L=function(e){return{start_idx:e[0],end_idx:e[1],params:H(e[2])}},V=function(e,n){var t={name:e,elevation:0,vertices:[],walls:[],lanes:[]};t.elevation=n.elevation;var a,r=Object(A.a)(n.vertices);try{for(r.s();!(a=r.n()).done;){var c=a.value;t.vertices.push(P(c))}}catch(d){r.e(d)}finally{r.f()}var i,o=Object(A.a)(n.walls);try{for(o.s();!(i=o.n()).done;){var s=i.value;t.walls.push(F(s))}}catch(d){o.e(d)}finally{o.f()}var l,u=Object(A.a)(n.lanes);try{for(u.s();!(l=u.n()).done;){var j=l.value;t.lanes.push(L(j))}}catch(d){u.e(d)}finally{u.f()}return t},q={name:"",filename:"",yaml:"",levels:[],lifts:[],crowd_sim:void 0},J=function(e,n){var t={};t.filename=e,t.yaml=n;var a=G.a.parse(n);for(var r in t.name=a.name,t.crowd_sim=a.crowd_sim,t.levels=[],a.levels){var c=a.levels[r];t.levels.push(V(r,c))}return console.log("parsed it"),t},T=function(){var e=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("http://localhost:8000/map_file").then((function(e){return e.text()})).then((function(e){return J("foo",e)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=r.a.createContext({building:q,updateBuilding:function(e){}}),U=t(13),W=Object(j.a)((function(e){return{directoryButton:{fontSize:e.typography.h5.fontSize},filename:{fontSize:e.typography.h5.fontSize,textDecoration:"underline"},dialog:{backgroundColor:e.palette.background.paper}}}));function K(e){var n=W(e),t=r.a.useContext(R).updateBuilding,a=r.a.useState([]),c=Object(u.a)(a,2),i=c[0],o=c[1],j=r.a.useState(),d=Object(u.a)(j,2),x=d[0],b=d[1],f=function(){var e=Object(l.a)(s.a.mark((function e(){var n,t,a,r,c,i,l,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o([]),e.next=3,window.showDirectoryPicker();case 3:return n=e.sent,e.next=6,b(n);case 6:t=!0,a=!1,e.prev=8,c=function(){var e=u;e.name.endsWith(".building.yaml")&&o((function(n){return[].concat(Object(g.a)(n),[e.name])}))},i=Object(y.a)(n.values());case 11:return e.next=13,i.next();case 13:return l=e.sent,t=l.done,e.next=17,l.value;case 17:if(u=e.sent,t){e.next=23;break}c();case 20:t=!0,e.next=11;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(8),a=!0,r=e.t0;case 29:if(e.prev=29,e.prev=30,t||null==i.return){e.next=34;break}return e.next=34,i.return();case 34:if(e.prev=34,!a){e.next=37;break}throw r;case 37:return e.finish(34);case 38:return e.finish(29);case 39:case"end":return e.stop()}}),e,null,[[8,25,29,39],[30,,34,38]])})));return function(){return e.apply(this,arguments)}}(),p=function(){var n=Object(l.a)(s.a.mark((function n(a){var r,c,i;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!x){n.next=11;break}return n.next=3,x.getFileHandle(a);case 3:return r=n.sent,n.next=6,r.getFile();case 6:return c=n.sent,n.next=9,c.text();case 9:i=n.sent,t(J(a,i));case 11:e.onOpen();case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return Object(U.jsxs)(w.a,{open:e.open,onClose:e.onCancel,children:[Object(U.jsx)(k.a,{children:"Open Building Map"}),Object(U.jsxs)(C.a,{className:n.dialog,children:[Object(U.jsx)(D.a,{variant:"contained",color:"primary",onClick:f,children:"Select Directory..."}),function(){if(i.length>0)return Object(U.jsx)("div",{children:Object(U.jsx)(M.a,{subheader:Object(U.jsx)(_.a,{component:"div",children:"Available Files"}),children:i.map((function(e){return Object(U.jsxs)(I.a,{button:!0,children:[Object(U.jsx)(E.a,{children:Object(U.jsx)(z.a,{})}),Object(U.jsx)(B.a,{primary:e,onClick:function(n){p(e)}})]},e)}))})})}()]}),Object(U.jsx)(S.a,{children:Object(U.jsx)(D.a,{onClick:e.onCancel,color:"primary",children:"Cancel"})})]})}var Q=t(177),X=t(187),Y=t(94),Z=t.n(Y),$=t(95),ee=t.n($);function ne(){var e=r.a.useContext(R).building;if(!e.filename)return Object(U.jsx)("p",{children:"No building loaded."});var n=10,t=function(e){return n+=3,Object(U.jsxs)(X.a,{nodeId:String(n-3),label:e.name,children:[Object(U.jsx)(X.a,{nodeId:String(n-2),label:"vertices",children:e.vertices.map((function(e){return function(e){n+=1;var t="("+e.x+", "+e.y+")";if(e.name&&(t+=" name: "+e.name),e.params.length){var a,r=Object(A.a)(e.params);try{for(r.s();!(a=r.n()).done;){var c=a.value;t+=" ".concat(c.name,"=").concat(c.value)}}catch(i){r.e(i)}finally{r.f()}}return Object(U.jsx)(X.a,{nodeId:String(n),label:t},n)}(e)}))},n-2),Object(U.jsx)(X.a,{nodeId:String(n-1),label:"walls",children:e.walls.map((function(e){return function(e){n+=1;var t="(".concat(e.start_idx," => ").concat(e.end_idx,")");return Object(U.jsx)(X.a,{nodeId:String(n),label:t},n)}(e)}))},n-1)]},n-3)};return Object(U.jsxs)(Q.a,{defaultCollapseIcon:Object(U.jsx)(Z.a,{}),defaultExpandIcon:Object(U.jsx)(ee.a,{}),defaultExpanded:["2"],children:[Object(U.jsx)(X.a,{nodeId:"0",label:"name: "+e.name}),Object(U.jsx)(X.a,{nodeId:"1",label:"filename: "+e.filename}),Object(U.jsx)(X.a,{nodeId:"2",label:"levels",children:e.levels.map((function(e){return t(e)}))})]})}var te=t(12),ae=t(44),re=t(186);function ce(){var e=r.a.useContext(R).building,n=function(e){var n=e.elevation/2,t=e.vertices.map((function(e){return function(e,n){var t=e.x/50,a=e.y/50;return Object(U.jsxs)("mesh",{position:[t,a,.25+n],scale:1,rotation:new te.Euler(Math.PI/2,0,0),children:[Object(U.jsx)("cylinderGeometry",{args:[.3,.3,.2,8]}),Object(U.jsx)("meshStandardMaterial",{color:"green"})]})}(e,n)})),a=e.walls.map((function(t){return function(e,n,t){var a=n[e.start_idx],r=n[e.end_idx],c=(a.x+r.x)/2/50,i=(a.y+r.y)/2/50,o=r.x-a.x,s=r.y-a.y,l=Math.sqrt(o*o+s*s)/50,u=Math.atan2(s,o);return Object(U.jsxs)("mesh",{position:[c,i,1+t],rotation:new te.Euler(0,0,u),scale:1,children:[Object(U.jsx)("boxGeometry",{args:[l,.1,2]}),Object(U.jsx)("meshStandardMaterial",{color:"#8080d0"})]})}(t,e.vertices,n)})),r=e.lanes.map((function(t){return function(e,n,t){var a=n[e.start_idx],r=n[e.end_idx],c=(a.x+r.x)/2/50,i=(a.y+r.y)/2/50,o=r.x-a.x,s=r.y-a.y,l=Math.sqrt(o*o+s*s)/50,u=Math.atan2(s,o);return Object(U.jsxs)("mesh",{position:[c,i,0+t],rotation:new te.Euler(0,0,u),scale:1,children:[Object(U.jsx)("boxGeometry",{args:[l,1,.1]}),Object(U.jsx)("meshStandardMaterial",{color:"#d08080"})]})}(t,e.vertices,n)})),c=Object(U.jsx)("gridHelper",{args:[100,100],rotation:new te.Euler(Math.PI/2,0,0),position:new te.Vector3(50,-50,n)});return[].concat(Object(g.a)(t),Object(g.a)(a),Object(g.a)(r),[c])},t=function(){var e=Object(ae.c)((function(e){return e.camera}));return e.up=new te.Vector3(0,0,1),te.Object3D.DefaultUp=new te.Vector3(0,0,1),Object(U.jsx)(re.a,{enableDamping:!1,camera:e})};return Object(U.jsxs)(ae.a,{frameloop:"demand",camera:{position:[3,-10,5]},children:[Object(U.jsx)(t,{}),Object(U.jsx)("axesHelper",{}),Object(U.jsx)("ambientLight",{}),Object(U.jsx)("pointLight",{position:[10,10,10]}),e.levels.map((function(e){return n(e)}))]})}var ie=Object(j.a)((function(e){return{root:{flexGrow:1,minHeight:"100vh"},flex:{flex:1},menuButton:{marginLeft:-12,marginRight:20},toolbarMargin:e.mixins.toolbar,workingArea:{backgroundColor:"black",height:"calc(100vh - 64px)"}}}));function oe(e){var n=r.a.useState(null),t=Object(u.a)(n,2),a=t[0],c=t[1],i=r.a.useState(!1),o=Object(u.a)(i,2),j=o[0],p=o[1],g=r.a.useState(q),y=Object(u.a)(g,2),w=y[0],k=y[1],C=ie(e);return Object(U.jsx)("div",{className:C.root,children:Object(U.jsxs)(R.Provider,{value:{building:w,updateBuilding:k},children:[Object(U.jsx)(d.a,{position:"fixed",children:Object(U.jsxs)(x.a,{children:[Object(U.jsx)(f.a,{className:C.menuButton,color:"inherit","aria-label":"Menu",onClick:function(e){c(e.currentTarget)},children:Object(U.jsx)(h.a,{})}),Object(U.jsxs)(v.a,{keepMounted:!0,anchorEl:a,open:Boolean(a),onClose:function(){return c(null)},getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[Object(U.jsx)(O.a,{onClick:Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=k,e.next=3,T();case 3:e.t1=e.sent,(0,e.t0)(e.t1),c(null);case 6:case"end":return e.stop()}}),e)}))),children:"Open map from localhost server"}),Object(U.jsx)(O.a,{onClick:function(){p(!0),c(null)},children:"Open map from local file..."})]}),Object(U.jsx)(b.a,{variant:"h5",color:"inherit",className:C.flex,children:"Traffic Editor"})]})}),Object(U.jsx)("div",{className:C.toolbarMargin}),Object(U.jsx)(K,{open:j,onOpen:function(){return p(!1)},onCancel:function(){return p(!1)}}),Object(U.jsxs)(m.a,{container:!0,spacing:0,children:[Object(U.jsx)(m.a,{item:!0,xs:3,children:Object(U.jsx)(ne,{})}),Object(U.jsx)(m.a,{item:!0,xs:9,className:C.workingArea,children:Object(U.jsx)(ce,{})})]})]})})}i.a.render(Object(U.jsx)(r.a.StrictMode,{children:Object(U.jsx)(oe,{})}),document.getElementById("root"))}},[[125,1,2]]]);
//# sourceMappingURL=main.b0b680f6.chunk.js.map