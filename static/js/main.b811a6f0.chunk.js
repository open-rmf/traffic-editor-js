(this["webpackJsonptraffic-editor-pwa"]=this["webpackJsonptraffic-editor-pwa"]||[]).push([[0],{112:function(e,t,n){},127:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(23),i=n.n(c),o=(n(112),n(10)),l=n.n(o),u=n(35),s=n(19),d=n(170),f=n(17),j=n(184),b=n(185),x=n(63),v=n(186),p=n(188),h=n(194),m=n(98),O=n.n(m),y=n(192),g=n(187),w=n(189),k=n(26),_=n(91),M=n(193),A=n(177),C=n(178),L=n(180),S=n(172),Y=n(174),I=n(128),z=n(175),D=n(176),E=n(93),B=n.n(E),N=n(179),T=n(9),P=n(1),F=n(2),G=n(3),H=n(4),R=n(99),U=n(191),q=function(){function e(){Object(P.a)(this,e),this.uuid="",this.params=[]}return Object(F.a)(e,[{key:"generate_uuid",value:function(){this.uuid=Object(U.a)()}}]),e}(),J=function(e){Object(G.a)(n,e);var t=Object(H.a)(n);function n(){var e;Object(P.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).type_idx=0,e.name="",e.value=null,e}return Object(F.a)(n,null,[{key:"fromYAML",value:function(e,t){var r=new n;return r.name=e,r.type_idx=t[0],r.value=t[1],r.generate_uuid(),r}}]),n}(q),V=function(e){if(!e)return[];var t=[];for(var n in e){var r=J.fromYAML(n,e[n]);t.push(r)}return t},W=function(e){Object(G.a)(n,e);var t=Object(H.a)(n);function n(){var e;Object(P.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).start_idx=-1,e.end_idx=-1,e}return Object(F.a)(n,null,[{key:"fromYAML",value:function(e){var t=new n;return t.start_idx=e[0],t.end_idx=e[1],t.generate_uuid(),t.params=V(e[2]),t}}]),n}(q),K=function(e){Object(G.a)(n,e);var t=Object(H.a)(n);function n(){var e;Object(P.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).start_idx=-1,e.end_idx=-1,e}return Object(F.a)(n,null,[{key:"fromYAML",value:function(e){var t=new n;return t.start_idx=e[0],t.end_idx=e[1],t.params=V(e[2]),t.generate_uuid(),t}}]),n}(q),Q=function(e){Object(G.a)(n,e);var t=Object(H.a)(n);function n(){var e;Object(P.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).vertex_indices=[],e}return Object(F.a)(n,null,[{key:"fromYAML",value:function(e){var t=new n;t.generate_uuid(),t.params=V(e.parameters);var r,a=Object(T.a)(e.vertices);try{for(a.s();!(r=a.n()).done;){var c=r.value;t.vertex_indices.push(c)}}catch(i){a.e(i)}finally{a.f()}return t}}]),n}(q),X=function(e){Object(G.a)(n,e);var t=Object(H.a)(n);function n(){var e;Object(P.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).x=0,e.y=0,e.name="",e}return Object(F.a)(n,null,[{key:"fromYAML",value:function(e){var t=new n;return t.x=e[0],t.y=-e[1],t.name=e[3],t.params=V(e[4]),t.generate_uuid(),t}}]),n}(q),Z=function(e){Object(G.a)(n,e);var t=Object(H.a)(n);function n(){var e;Object(P.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).name="",e.elevation=0,e.vertices=[],e.walls=[],e.lanes=[],e.floors=[],e}return Object(F.a)(n,null,[{key:"fromYAML",value:function(e,t){var r=new n;r.name=e,r.elevation=t.elevation,r.generate_uuid();var a,c=Object(T.a)(t.vertices);try{for(c.s();!(a=c.n()).done;){var i=a.value;r.vertices.push(X.fromYAML(i))}}catch(v){c.e(v)}finally{c.f()}var o,l=Object(T.a)(t.walls);try{for(l.s();!(o=l.n()).done;){var u=o.value;r.walls.push(K.fromYAML(u))}}catch(v){l.e(v)}finally{l.f()}var s,d=Object(T.a)(t.lanes);try{for(d.s();!(s=d.n()).done;){var f=s.value;r.lanes.push(W.fromYAML(f))}}catch(v){d.e(v)}finally{d.f()}var j,b=Object(T.a)(t.floors);try{for(b.s();!(j=b.n()).done;){var x=j.value;r.floors.push(Q.fromYAML(x))}}catch(v){b.e(v)}finally{b.f()}return r}}]),n}(q),$=function(e){Object(G.a)(n,e);var t=Object(H.a)(n);function n(){var e;Object(P.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).name="",e.filename="",e.yaml="",e.levels=[],e.lifts=[],e.crowd_sim=void 0,e}return Object(F.a)(n,null,[{key:"fromYAML",value:function(e){var t=new n;t.yaml=e;var r=R.a.parse(e);for(var a in t.name=r.name,t.crowd_sim=r.crowd_sim,t.levels=[],r.levels){var c=r.levels[a];t.levels.push(Z.fromYAML(a,c))}return t.generate_uuid(),t}},{key:"fromURL",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(t).then((function(e){return e.text()})).then((function(e){return n.fromYAML(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fromDemo",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/traffic-editor-js"+"/demos/".concat(t,"/").concat(t,".building.yaml")).then((function(e){return e.text()})).then((function(e){return n.fromYAML(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(q),ee=a.a.createContext({building:new $,updateBuilding:function(){}}),te=n(11),ne=Object(d.a)((function(e){return{directoryButton:{fontSize:e.typography.h5.fontSize},filename:{fontSize:e.typography.h5.fontSize,textDecoration:"underline"},dialog:{backgroundColor:e.palette.background.paper}}}));function re(e){var t=ne(e),n=a.a.useContext(ee).updateBuilding,r=a.a.useState([]),c=Object(s.a)(r,2),i=c[0],o=c[1],d=a.a.useState(),f=Object(s.a)(d,2),j=f[0],b=f[1],x=function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r,a,c,i,u,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o([]),e.next=3,window.showDirectoryPicker();case 3:return t=e.sent,e.next=6,b(t);case 6:n=!0,r=!1,e.prev=8,c=function(){var e=s;e.name.endsWith(".building.yaml")&&o((function(t){return[].concat(Object(k.a)(t),[e.name])}))},i=Object(_.a)(t.values());case 11:return e.next=13,i.next();case 13:return u=e.sent,n=u.done,e.next=17,u.value;case 17:if(s=e.sent,n){e.next=23;break}c();case 20:n=!0,e.next=11;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(8),r=!0,a=e.t0;case 29:if(e.prev=29,e.prev=30,n||null==i.return){e.next=34;break}return e.next=34,i.return();case 34:if(e.prev=34,!r){e.next=37;break}throw a;case 37:return e.finish(34);case 38:return e.finish(29);case 39:case"end":return e.stop()}}),e,null,[[8,25,29,39],[30,,34,38]])})));return function(){return e.apply(this,arguments)}}(),v=function(){var t=Object(u.a)(l.a.mark((function t(r){var a,c,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!j){t.next=11;break}return t.next=3,j.getFileHandle(r);case 3:return a=t.sent,t.next=6,a.getFile();case 6:return c=t.sent,t.next=9,c.text();case 9:i=t.sent,n($.fromYAML(i));case 11:e.onOpen();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(te.jsxs)(M.a,{open:e.open,onClose:e.onCancel,children:[Object(te.jsx)(A.a,{children:"Open Building Map"}),Object(te.jsxs)(C.a,{className:t.dialog,children:[Object(te.jsx)(N.a,{variant:"contained",color:"primary",onClick:x,children:"Select Directory..."}),function(){if(i.length>0)return Object(te.jsx)("div",{children:Object(te.jsx)(S.a,{subheader:Object(te.jsx)(Y.a,{component:"div",children:"Available Files"}),children:i.map((function(e){return Object(te.jsxs)(I.a,{button:!0,children:[Object(te.jsx)(z.a,{children:Object(te.jsx)(B.a,{})}),Object(te.jsx)(D.a,{primary:e,onClick:function(t){v(e)}})]},e)}))})})}()]}),Object(te.jsx)(L.a,{children:Object(te.jsx)(N.a,{onClick:e.onCancel,color:"primary",children:"Cancel"})})]})}var ae=n(181),ce=n(195),ie=n(94),oe=n.n(ie),le=n(95),ue=n.n(le);function se(){var e=a.a.useContext(ee).building;if(!e.name)return Object(te.jsx)("p",{children:"No building loaded."});var t=function(e){return Object(te.jsx)(ce.a,{nodeId:e.uuid,label:"".concat(e.name,"=").concat(e.value)})},n=function(e){return Object(te.jsxs)(ce.a,{nodeId:e.uuid,label:e.name,children:[Object(te.jsx)(ce.a,{nodeId:e.uuid+"_vertices",label:"vertices",children:e.vertices.map((function(e){return function(e){var n="("+e.x+", "+e.y+")";return e.name&&(n=e.name+": "+n),Object(te.jsx)(ce.a,{nodeId:e.uuid,label:n,children:e.params.map((function(e){return t(e)}))})}(e)}))}),Object(te.jsx)(ce.a,{nodeId:e.uuid+"_walls",label:"walls",children:e.walls.map((function(e){return function(e){var t="(".concat(e.start_idx," => ").concat(e.end_idx,")");return Object(te.jsx)(ce.a,{nodeId:e.uuid,label:t})}(e)}))}),Object(te.jsx)(ce.a,{nodeId:e.uuid+"_floors",label:"floors",children:e.floors.map((function(e){return function(e){var n="floor (";return n+=e.vertex_indices.map((function(e){return e.toString()})).join(", ")+")",Object(te.jsx)(ce.a,{nodeId:e.uuid,label:n,children:e.params.map((function(e){return t(e)}))})}(e)}))})]})};return Object(te.jsxs)(ae.a,{defaultCollapseIcon:Object(te.jsx)(oe.a,{}),defaultExpandIcon:Object(te.jsx)(ue.a,{}),defaultExpanded:["2"],children:[Object(te.jsx)(ce.a,{nodeId:e.uuid+"_name",label:"name: "+e.name}),Object(te.jsx)(ce.a,{nodeId:e.uuid+"_levels",label:"levels",children:e.levels.map((function(e){return n(e)}))})]})}var de=n(13),fe=n(30),je=n(182),be=n(183);function xe(e){var t=a.a.useMemo((function(){var t,n=new de.Shape,r=!1,a=Object(T.a)(e.floor.vertex_indices);try{for(a.s();!(t=a.n()).done;){var c=t.value,i=e.vertices[c];r?n.lineTo(i.x/50,i.y/50):(n.moveTo(i.x/50,i.y/50),r=!0)}}catch(l){a.e(l)}finally{a.f()}var o=e.vertices[e.floor.vertex_indices[0]];return n.lineTo(o.x/50,o.y/50),n}),[e.floor,e.vertices]);return Object(te.jsxs)("mesh",{children:[Object(te.jsx)("extrudeGeometry",{args:[t,{depth:.1,bevelEnabled:!1}]}),Object(te.jsx)("meshStandardMaterial",{color:"#ffffff"})]})}function ve(e){var t=a.a.useContext(ee).building,n=function(e){var t=e.elevation/2,n=e.vertices.map((function(e){return function(e,t){var n=e.x/50,r=e.y/50;return Object(te.jsxs)("mesh",{position:[n,r,.25+t],scale:1,rotation:new de.Euler(Math.PI/2,0,0),children:[Object(te.jsx)("cylinderGeometry",{args:[.3,.3,.2,8]}),Object(te.jsx)("meshStandardMaterial",{color:"green"})]})}(e,t)})),r=e.walls.map((function(n){return function(e,t,n){var r=t[e.start_idx],a=t[e.end_idx],c=(r.x+a.x)/2/50,i=(r.y+a.y)/2/50,o=a.x-r.x,l=a.y-r.y,u=Math.sqrt(o*o+l*l)/50,s=Math.atan2(l,o);return Object(te.jsxs)("mesh",{position:[c,i,1+n],rotation:new de.Euler(0,0,s),scale:1,children:[Object(te.jsx)("boxGeometry",{args:[u,.1,2]}),Object(te.jsx)("meshStandardMaterial",{color:"#8080d0"})]})}(n,e.vertices,t)})),a=e.lanes.map((function(n){return function(e,t,n){var r=t[e.start_idx],a=t[e.end_idx],c=(r.x+a.x)/2/50,i=(r.y+a.y)/2/50,o=a.x-r.x,l=a.y-r.y,u=Math.sqrt(o*o+l*l)/50,s=Math.atan2(l,o);return Object(te.jsxs)("mesh",{position:[c,i,.2+n],rotation:new de.Euler(0,0,s),scale:1,children:[Object(te.jsx)("boxGeometry",{args:[u,1,.1]}),Object(te.jsx)("meshStandardMaterial",{color:"#c04040"})]})}(n,e.vertices,t)})),c=e.floors.map((function(n){return Object(te.jsx)(xe,{floor:n,vertices:e.vertices,elevation:t})}));return[].concat(Object(k.a)(n),Object(k.a)(r),Object(k.a)(a),Object(k.a)(c))},r=function(){var t=Object(fe.c)((function(e){return e.camera}));return"3d"===e.mode?(t.up=new de.Vector3(0,0,1),t.position.x=20,t.position.y=-20,t.position.z=5,de.Object3D.DefaultUp=new de.Vector3(0,0,1),t.updateProjectionMatrix(),Object(te.jsx)(je.a,{enableDamping:!1,camera:t,target:[20,-10,0]})):(t.zoom=10,t.position.z=5,t.updateProjectionMatrix(),Object(te.jsx)(be.a,{enableDamping:!1,target:[10,-10,0],camera:t,maxPolarAngle:0,minAzimuthAngle:0,maxAzimuthAngle:0}))},c=function(t){return console.log("EditorCanvas"),"3d"===e.mode?Object(te.jsx)(fe.a,{frameloop:"demand",children:t?t.children:Object(te.jsx)(te.Fragment,{})}):Object(te.jsx)(fe.a,{frameloop:"demand",orthographic:!0,children:t?t.children:Object(te.jsx)(te.Fragment,{})})};return Object(te.jsxs)(c,{children:[Object(te.jsx)(r,{}),Object(te.jsx)("axesHelper",{}),Object(te.jsx)("ambientLight",{}),Object(te.jsx)("pointLight",{position:[10,10,10]}),t.levels.map((function(e){return n(e)}))]})}var pe=Object(d.a)((function(e){return{root:{flexGrow:1,minHeight:"100vh"},flex:{flex:1},menuButton:{marginLeft:-12,marginRight:20},toolbarMargin:e.mixins.toolbar,workingArea:{backgroundColor:"black",height:"calc(100vh - 64px)"}}})),he=Object(f.a)((function(e){return{root:{backgroundColor:e.palette.primary.light,padding:e.spacing(.5)},grouped:{color:e.palette.primary.contrastText,"&.Mui-selected:hover, &:hover":{background:e.palette.primary.dark},"&.Mui-selected":{background:e.palette.primary.dark,color:e.palette.primary.contrastText}}}}))(h.a);function me(e){var t=a.a.useState(null),n=Object(s.a)(t,2),r=n[0],c=n[1],i=a.a.useState(!1),o=Object(s.a)(i,2),d=o[0],f=o[1],h=a.a.useState(new $),m=Object(s.a)(h,2),k=m[0],_=m[1],M=a.a.useState("3d"),A=Object(s.a)(M,2),C=A[0],L=A[1],S=pe(e);return Object(te.jsx)("div",{className:S.root,children:Object(te.jsxs)(ee.Provider,{value:{building:k,updateBuilding:_},children:[Object(te.jsx)(j.a,{position:"fixed",children:Object(te.jsxs)(b.a,{children:[Object(te.jsx)(v.a,{className:S.menuButton,color:"inherit","aria-label":"Menu",onClick:function(e){c(e.currentTarget)},children:Object(te.jsx)(O.a,{})}),Object(te.jsxs)(y.a,{keepMounted:!0,anchorEl:r,open:Boolean(r),onClose:function(){return c(null)},getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},transitionDuration:0,children:[Object(te.jsx)(g.a,{onClick:Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=_,e.next=3,$.fromURL("http://localhost:8000/map_file");case 3:e.t1=e.sent,(0,e.t0)(e.t1),c(null);case 6:case"end":return e.stop()}}),e)}))),children:"Open map from localhost:8000"}),Object(te.jsx)(g.a,{onClick:Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=_,e.next=3,$.fromDemo("office");case 3:e.t1=e.sent,(0,e.t0)(e.t1),c(null);case 6:case"end":return e.stop()}}),e)}))),children:"Open demo map"}),Object(te.jsx)(g.a,{onClick:function(){f(!0),c(null)},children:"Open map from local file..."})]}),Object(te.jsx)(x.a,{variant:"h6",color:"inherit",className:S.flex,children:"Traffic Editor"}),Object(te.jsxs)(he,{value:C,size:"small",exclusive:!0,onChange:function(e,t){null!==t&&L(t)},"aria-label":"editor mode",children:[Object(te.jsx)(p.a,{value:"3d",children:"3D"}),Object(te.jsx)(p.a,{value:"2d",children:"2D"})]})]})}),Object(te.jsx)("div",{className:S.toolbarMargin}),Object(te.jsx)(re,{open:d,onOpen:function(){return f(!1)},onCancel:function(){return f(!1)}}),Object(te.jsxs)(w.a,{container:!0,spacing:0,children:[Object(te.jsx)(w.a,{item:!0,xs:3,children:Object(te.jsx)(se,{})}),Object(te.jsx)(w.a,{item:!0,xs:9,className:S.workingArea,children:Object(te.jsx)(ve,{mode:C})})]})]})})}i.a.render(Object(te.jsx)(a.a.StrictMode,{children:Object(te.jsx)(me,{})}),document.getElementById("root"))}},[[127,1,2]]]);
//# sourceMappingURL=main.b811a6f0.chunk.js.map